<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>è¿‘æœŸæ¯”èµ›å¤ç°Vol.1 | Chemtrails</title><meta name="keywords" content="ECC,RSA,æµå¯†ç "><meta name="author" content="Chemtrails"><meta name="copyright" content="Chemtrails"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="è¿‘æœŸæ¯”èµ›å¤ç°Vol.1"><meta name="application-name" content="è¿‘æœŸæ¯”èµ›å¤ç°Vol.1"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="default"><link rel="bookmark" href="/img/siteicon/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" sizes="180x180" href="/img/siteicon/apple-touch-icon.png"><link rel="apple-touch-icon" sizes="192x192" href="/img/siteicon/apple-touch-icon.png"><link rel="apple-touch-icon" sizes="512x512" href="/img/siteicon/apple-touch-icon.png"><link rel="apple-touch-startup-image" media="screen and (device-width:320px) and (device-height:568px) and (-webkit-device-pixel-ratio:2) and (orientation:landscape)" href="/img/siteicon/splashIcons/icon_1136x640.png"><link rel="apple-touch-startup-image" media="screen and (device-width:320px) and (device-height:568px) and (-webkit-device-pixel-ratio:2) and (orientation:portrait)" href="/img/siteicon/splashIcons/icon_640x1136.png"><link rel="apple-touch-startup-image" media="screen and (device-width:414px) and (device-height:896px) and (-webkit-device-pixel-ratio:3) and (orientation:landscape)" href="/img/siteicon/splashIcons/icon_2688x1242.png"><link rel="apple-touch-startup-image" media="screen and (device-width:414px) and (device-height:896px) and (-webkit-device-pixel-ratio:2) and (orientation:landscape)" href="/img/siteicon/splashIcons/icon_1792x828.png"><link rel="apple-touch-startup-image" media="screen and (device-width:375px) and (device-height:812px) and (-webkit-device-pixel-ratio:3) and (orientation:portrait)" href="/img/siteicon/splashIcons/icon_1125x2436.png"><link rel="apple-touch-startup-image" media="screen and (device-width:414px) and (device-height:896px) and (-webkit-device-pixel-ratio:2) and (orientation:portrait)" href="/img/siteicon/splashIcons/icon_828x1792.png"><link rel="apple-touch-startup-image" media="screen and (device-width:375px) and (device-height:812px) and (-webkit-device-pixel-ratio:3) and (orientation:landscape)" href="/img/siteicon/splashIcons/icon_2436x1125.png"><link rel="apple-touch-startup-image" media="screen and (device-width:414px) and (device-height:736px) and (-webkit-device-pixel-ratio:3) and (orientation:portrait)" href="/img/siteicon/splashIcons/icon_1242x2208.png"><link rel="apple-touch-startup-image" media="screen and (device-width:414px) and (device-height:736px) and (-webkit-device-pixel-ratio:3) and (orientation:landscape)" href="/img/siteicon/splashIcons/icon_2208x1242.png"><link rel="apple-touch-startup-image" media="screen and (device-width:375px) and (device-height:667px) and (-webkit-device-pixel-ratio:2) and (orientation:landscape)" href="/img/siteicon/splashIcons/icon_1334x750.png"><link rel="apple-touch-startup-image" media="screen and (device-width:375px) and (device-height:667px) and (-webkit-device-pixel-ratio:2) and (orientation:portrait)" href="/img/siteicon/splashIcons/icon_750x1334.png"><link rel="apple-touch-startup-image" media="screen and (device-width:1024px) and (device-height:1366px) and (-webkit-device-pixel-ratio:2) and (orientation:landscape)" href="/img/siteicon/splashIcons/icon_2732x2048.png"><meta name="description" content="SCTFBarterï¼ˆèµ›åï¼‰ä¸¤ä¸ªæ–‡ä»¶ï¼š sageï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152from Crypto.Util.number import *from random import *from secrets import flagdef">
<meta property="og:type" content="article">
<meta property="og:title" content="è¿‘æœŸæ¯”èµ›å¤ç°Vol.1">
<meta property="og:url" content="http://example.com/2023/07/06/%E8%BF%91%E6%9C%9F%E6%AF%94%E8%B5%9B%E5%A4%8D%E7%8E%B0Vol.1/index.html">
<meta property="og:site_name" content="Chemtrails">
<meta property="og:description" content="SCTFBarterï¼ˆèµ›åï¼‰ä¸¤ä¸ªæ–‡ä»¶ï¼š sageï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152from Crypto.Util.number import *from random import *from secrets import flagdef">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2023/07/06/OPygW8bCAT6UmXf.png">
<meta property="article:published_time" content="2023-07-06T08:11:13.000Z">
<meta property="article:modified_time" content="2024-04-11T05:30:00.877Z">
<meta property="article:author" content="Chemtrails">
<meta property="article:tag" content="ECC">
<meta property="article:tag" content="RSA">
<meta property="article:tag" content="æµå¯†ç ">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2023/07/06/OPygW8bCAT6UmXf.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2023/07/06/%E8%BF%91%E6%9C%9F%E6%AF%94%E8%B5%9B%E5%A4%8D%E7%8E%B0Vol.1/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://npm.elemecdn.com/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/@fancyapps/ui@4.0.31/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  navMusic: true,
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç®€"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":600},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'å¤©',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“","cht_to_chs":"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“","day_to_night":"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#3b70fc","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://npm.elemecdn.com/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://npm.elemecdn.com/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'è¿‘æœŸæ¯”èµ›å¤ç°Vol.1',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-11 13:30:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/"><div class="title">Chemtrails</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><center id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></center></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><span> æ–‡ç« </span></a><ul class="menus_item_child" style="left:-79px;"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> åˆ†ç±»</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> æ ‡ç­¾</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><span> å‹é“¾</span></a><ul class="menus_item_child" style="left:17px;"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> å‹äººå¸</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><span> å…³äº</span></a><ul class="menus_item_child" style="left:-31px;"><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> é—²è¨€ç¢è¯­</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> éšä¾¿é€›é€›</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="éšæœºå‰å¾€ä¸€ä¸ªæ–‡ç« " href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="æœç´¢ğŸ”"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> æœç´¢</span></a></div><div class="nav-button" id="darkmode_navswitch"><a class="darkmode_switchbutton" type="button" href="javascript:void(0);" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢" onclick="rm.switchDarkMode()"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke" style="font-size: 1.3rem"></i></a></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">è¿‘æœŸæ¯”èµ›å¤ç°Vol.1</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2023-07-06T08:11:13.000Z" title="å‘è¡¨äº 2023-07-06 16:11:13">2023-07-06</time><span class="post-meta-separator">|</span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2024-04-11T05:30:00.877Z" title="æ›´æ–°äº 2024-04-11 13:30:00">2024-04-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/">CTF</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">5.6k</span><span class="post-meta-separator">|</span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>30åˆ†é’Ÿ</span></span></div></div></div><article class="post-content" id="article-container"><h1 id="SCTF"><a href="#SCTF" class="headerlink" title="SCTF"></a>SCTF</h1><h2 id="Barterï¼ˆèµ›åï¼‰"><a href="#Barterï¼ˆèµ›åï¼‰" class="headerlink" title="Barterï¼ˆèµ›åï¼‰"></a>Barterï¼ˆèµ›åï¼‰</h2><p>ä¸¤ä¸ªæ–‡ä»¶ï¼š</p>
<p>sageï¼š</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_random</span>(<span class="params">seed, P, Q, r_list, times</span>):</span><br><span class="line">    s = seed</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(times):</span><br><span class="line">        s = <span class="built_in">int</span>((s * P)[<span class="number">0</span>])</span><br><span class="line">        r = <span class="built_in">int</span>((s * Q)[<span class="number">0</span>])</span><br><span class="line">        r_list.append(r)</span><br><span class="line">    <span class="keyword">return</span> r_list</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_seed</span>():</span><br><span class="line">    seed = getRandomNBitInteger(<span class="number">32</span>)</span><br><span class="line">    <span class="keyword">return</span> seed</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getP_Q</span>():</span><br><span class="line">    Q = Curve.random_point()</span><br><span class="line">    P = <span class="number">114514</span>*Q</span><br><span class="line">    <span class="keyword">return</span> P, Q</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">flag, rlist</span>):</span><br><span class="line">    seq = <span class="built_in">list</span>(randint(<span class="number">0</span>, <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>))</span><br><span class="line">    add = rlist[<span class="number">55</span>]*(seq[<span class="number">0</span>]*rlist[<span class="number">66</span>] + seq[<span class="number">1</span>]*rlist[<span class="number">77</span>] + seq[<span class="number">2</span>]*rlist[<span class="number">88</span>] + seq[<span class="number">3</span>]*rlist[<span class="number">99</span>])</span><br><span class="line">    xor = <span class="built_in">pow</span>(rlist[<span class="number">114</span>], rlist[<span class="number">514</span>], rlist[<span class="number">233</span>]*rlist[<span class="number">223</span>])</span><br><span class="line">    enc = (bytes_to_long(flag)^^xor)+add</span><br><span class="line">    <span class="keyword">return</span> enc</span><br><span class="line"></span><br><span class="line">nums = <span class="number">600</span></span><br><span class="line"></span><br><span class="line">seed = gen_seed()</span><br><span class="line"></span><br><span class="line">p = <span class="number">58836547289031152641641668761108233140346455328711205590162376160181002854061</span></span><br><span class="line">F = GF(p)</span><br><span class="line">a = F(<span class="number">114</span>)</span><br><span class="line">b = F(<span class="number">514</span>)</span><br><span class="line">Curve = EllipticCurve(F, [a, b])</span><br><span class="line">P, Q = getP_Q()</span><br><span class="line">r_list = []</span><br><span class="line">r_list = gen_random(seed, P, Q, r_list, nums)</span><br><span class="line">ENCFLAG = enc(flag, r_list)</span><br><span class="line"><span class="built_in">print</span>(ENCFLAG)</span><br><span class="line"><span class="built_in">print</span>(P, Q)</span><br><span class="line"><span class="built_in">print</span>(r_list[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">4911741083112145038719536311222612998219730565328651097326896414315857050336523018712625917027324116103593300559128797807261543857571883314990480072241188</span></span><br><span class="line"><span class="string">#####################################</span></span><br><span class="line"><span class="string">#####################################</span></span><br><span class="line"><span class="string">Oh no, P, Q and r_list[0] are accidentally lost, but John seems to know, you can ask him about these missing values ::&gt;_&lt;::</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>homework.pyï¼š</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> params <span class="keyword">import</span> N, E, D</span><br><span class="line"><span class="keyword">from</span> leak_data <span class="keyword">import</span> P, Q, r_1</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">challenge</span>():</span><br><span class="line">    meum = <span class="string">&#x27;&#x27;&#x27;option:</span></span><br><span class="line"><span class="string">    1: get pubkey</span></span><br><span class="line"><span class="string">    2: get sign</span></span><br><span class="line"><span class="string">    3: verify</span></span><br><span class="line"><span class="string">    4: exit&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Hi, I am John. If you help me with my homework, I&#x27;ll give you the data that I know (ï¿£oï¿£) . z Z&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(meum)</span><br><span class="line">    sign = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;[+]input your option: &#x27;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        your_input = <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> your_input == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;[+]N = <span class="subst">&#123;N&#125;</span>&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;[+]e = <span class="subst">&#123;E&#125;</span>&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> your_input == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">            sign = <span class="built_in">pow</span>(bytes_to_long(MSG.encode()), D, N)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&#x27;[+]sign = <span class="subst">&#123;sign&#125;</span>&#x27;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> your_input == <span class="string">&#x27;3&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> sign <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;[+]Please input option 2 to generate sign first.&#x27;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            msg_user = <span class="built_in">input</span>(<span class="string">&quot;[+]Please input your message: &quot;</span>)</span><br><span class="line">            n = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;[+]Please input n: &quot;</span>))</span><br><span class="line">            e = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;[+]Please input e: &quot;</span>))</span><br><span class="line">            <span class="keyword">if</span> e &lt;= <span class="number">3</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;[+]e is invalid&#x27;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> re.<span class="keyword">match</span>(<span class="string">r&#x27;I can not agree more!!!$&#x27;</span>, msg_user):</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">pow</span>(bytes_to_long(msg_user.encode()), e, n) == sign:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&quot;Goooooooood! You are my hero! I can give you the data that I know â•°(*Â°â–½Â°*)â•¯&quot;</span>)</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">f&#x27;Leak_data: \n P=<span class="subst">&#123;P&#125;</span>\n Q=<span class="subst">&#123;Q&#125;</span>\n first num in r_list=<span class="subst">&#123;r_1&#125;</span>&#x27;</span>)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">&#x27;[+]Error signature!&#x27;</span>)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&#x27;[+]Error message!&#x27;</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> your_input == <span class="string">&#x27;4&#x27;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    MSG = <span class="string">&#x27;This is an easy challenge&#x27;</span></span><br><span class="line">    challenge()</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªé¢˜éœ€è¦å…ˆç ´è§£homeworkå¾—åˆ°PQå’Œræ‰èƒ½å»è§£æ¤­åœ†æ›²çº¿ã€‚</p>
<p>homeworkç ´è§£éå¸¸ç®€å•ï¼Œå¯¹æ–¹éšæœºç”ŸæˆRSAå‚æ•°è¿›è¡ŒåŠ å¯†ï¼Œéœ€è¦æˆ‘ä»¬ç”¨<code>I can not agree more!!!</code>è¿™ä¸²ä½œä¸ºmå¹¶å‘é€æˆ‘ä»¬çš„eå’Œnå†è¿›è¡Œä¸€æ¬¡åŠ å¯†ï¼Œå¦‚æœä¸¤æ¬¡åŠ å¯†å€¼ç›¸åŒå°±è¿”å›æ¤­åœ†æ›²çº¿å‚æ•°ã€‚</p>
<p>ç›´æ¥ç”Ÿæˆä¸€ä¸ªå°eå³å¯ï¼Œæœ‰$sign=m^e\bmod n$å¯ç›´æ¥å‡è®¾ï¼š</p>
<script type="math/tex; mode=display">
n=m^e-sign</script><p>ä¼ å€¼ï¼Œå¾—åˆ°è¿”å›å‚æ•°ï¼š</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">P=(<span class="number">24181776889473219401017476947331354458592459788552219617833554538756564211844</span>, <span class="number">33783050059316681746742286692492975385672807657476634456871855157562656976035</span>)</span><br><span class="line">Q=(<span class="number">16104852983623236554878602983757606922134442855643833150623643268638509292839</span>, <span class="number">3562830444362909774600777083869972812060967068803593091854731534842281574275</span>)</span><br><span class="line">first num <span class="keyword">in</span> r_list=<span class="number">50920555924101118476219158701093345090627150442059647242030060086626996278598</span></span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é¢˜çš„æ¤­åœ†æ›²çº¿é‡Œç”Ÿæˆäº†ä¸€ä¸ªéšæœºæ•°åºåˆ—ï¼š</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">gen_random</span>(<span class="params">seed, P, Q, r_list, times</span>):</span><br><span class="line">    s = seed</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(times):</span><br><span class="line">        s = <span class="built_in">int</span>((s * P)[<span class="number">0</span>])</span><br><span class="line">        r = <span class="built_in">int</span>((s * Q)[<span class="number">0</span>])</span><br><span class="line">        r_list.append(r)</span><br><span class="line">    <span class="keyword">return</span> r_list</span><br></pre></td></tr></table></figure>
<p>è€Œä¸”PQçš„å…³ç³»ä¹Ÿæ˜¯å·²çŸ¥çš„ï¼š</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">getP_Q</span>():</span><br><span class="line">    Q = Curve.random_point()</span><br><span class="line">    P = <span class="number">114514</span>*Q</span><br><span class="line">    <span class="keyword">return</span> P, Q</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å·²çŸ¥äº†$PQ$å’Œ$r_0$ï¼Œä¸çŸ¥é“seedï¼Œç”¨å…¬å¼è§‚å¯Ÿä¸€ä¸‹è¯•è¯•ï¼š</p>
<script type="math/tex; mode=display">
P=114514\cdot Q</script><script type="math/tex; mode=display">
s_0=(s\cdot P)_x=(114514\cdot s\cdot Q)_x</script><script type="math/tex; mode=display">
r_0=(s_0\cdot Q)_x=((114514\cdot s\cdot Q)_x\cdot Q)_x</script><script type="math/tex; mode=display">
s_1=(s_0\cdot P)_x=((114514\cdot s\cdot Q)_x\cdot 114514\cdot Q)_x</script><p>å¯ä»¥å‘ç°$s_1$å’Œ$r_0$åœ¨æ¤­åœ†æ›²çº¿ä¸Šå·®äº†$114514$å€ï¼Œæˆ‘ä»¬çŸ¥é“$r_0$äº†ï¼Œä»£å…¥æ›²çº¿å¯ä»¥æ±‚$s_1$ï¼Œç´§æ¥ç€å¯ä»¥åå¤æŠŠ$r$æ•°ç»„å…¨éƒ¨è¿˜åŸï¼Œå‰©ä¸‹çš„ç›´æ¥ç…§æ¬å¼‚æˆ–å°±å‡ºäº†ï¼š</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">p = <span class="number">58836547289031152641641668761108233140346455328711205590162376160181002854061</span></span><br><span class="line">F = GF(p)</span><br><span class="line">a = F(<span class="number">114</span>)</span><br><span class="line">b = F(<span class="number">514</span>)</span><br><span class="line">E = EllipticCurve(F, [a, b])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">P=E(<span class="number">24181776889473219401017476947331354458592459788552219617833554538756564211844</span>, <span class="number">33783050059316681746742286692492975385672807657476634456871855157562656976035</span>)</span><br><span class="line">Q=E(<span class="number">16104852983623236554878602983757606922134442855643833150623643268638509292839</span>, <span class="number">3562830444362909774600777083869972812060967068803593091854731534842281574275</span>)</span><br><span class="line"></span><br><span class="line">r0=<span class="number">50920555924101118476219158701093345090627150442059647242030060086626996278598</span></span><br><span class="line">enc=<span class="number">4911741083112145038719536311222612998219730565328651097326896414315857050336523018712625917027324116103593300559128797807261543857571883314990480072241188</span></span><br><span class="line"></span><br><span class="line">rlist = [r0]</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">600</span>):</span><br><span class="line">    s = (E.lift_x(rlist[-<span class="number">1</span>])*<span class="number">114514</span>)[<span class="number">0</span>]</span><br><span class="line">    rlist.append((s * Q)[<span class="number">0</span>])</span><br><span class="line">    </span><br><span class="line">rlist = [<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> rlist]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>^<span class="number">4</span>):</span><br><span class="line">    seq = []</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        seq.append(i&amp;<span class="number">1</span>)</span><br><span class="line">        i &gt;&gt;=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    add = rlist[<span class="number">55</span>]*(seq[<span class="number">0</span>]*rlist[<span class="number">66</span>] + seq[<span class="number">1</span>]*rlist[<span class="number">77</span>] + seq[<span class="number">2</span>]*rlist[<span class="number">88</span>] + seq[<span class="number">3</span>]*rlist[<span class="number">99</span>])</span><br><span class="line">    xor = <span class="built_in">pow</span>(rlist[<span class="number">114</span>], rlist[<span class="number">514</span>], rlist[<span class="number">233</span>]*rlist[<span class="number">223</span>])</span><br><span class="line">    flag = long_to_bytes(<span class="built_in">int</span>((enc-add)^^xor))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;SCTF&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<h1 id="GoogleCTF"><a href="#GoogleCTF" class="headerlink" title="GoogleCTF"></a>GoogleCTF</h1><h2 id="LCGï¼ˆèµ›åï¼‰"><a href="#LCGï¼ˆèµ›åï¼‰" class="headerlink" title="LCGï¼ˆèµ›åï¼‰"></a>LCGï¼ˆèµ›åï¼‰</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> config</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, isPrime</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LCG</span>:</span><br><span class="line">    lcg_m = config.m</span><br><span class="line">    lcg_c = config.c</span><br><span class="line">    lcg_n = config.n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, lcg_s</span>):</span><br><span class="line">        self.state = lcg_s</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">        self.state = (self.state * self.lcg_m + self.lcg_c) % self.lcg_n</span><br><span class="line">        <span class="keyword">return</span> self.state</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Find prime value of specified bits a specified amount of times</span></span><br><span class="line">    seed = <span class="number">211286818345627549183608678726370412218029639873054513839005340650674982169404937862395980568550063504804783328450267566224937880641772833325018028629959635</span></span><br><span class="line">    lcg = LCG(seed)</span><br><span class="line">    primes_arr = []</span><br><span class="line">    </span><br><span class="line">    dump = <span class="literal">True</span></span><br><span class="line">    items = <span class="number">0</span></span><br><span class="line">    dump_file = <span class="built_in">open</span>(<span class="string">&quot;dump.txt&quot;</span>, <span class="string">&quot;w&quot;</span>)</span><br><span class="line"></span><br><span class="line">    primes_n = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(config.it):</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                prime_candidate = lcg.<span class="built_in">next</span>()</span><br><span class="line">                <span class="keyword">if</span> dump:</span><br><span class="line">                    dump_file.write(<span class="built_in">str</span>(prime_candidate) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">                    items += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">if</span> items == <span class="number">6</span>:</span><br><span class="line">                        dump = <span class="literal">False</span></span><br><span class="line">                        dump_file.close()</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> isPrime(prime_candidate):</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">elif</span> prime_candidate.bit_length() != config.bits:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    primes_n *= prime_candidate</span><br><span class="line">                    primes_arr.append(prime_candidate)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Check bit length</span></span><br><span class="line">        <span class="keyword">if</span> primes_n.bit_length() &gt; <span class="number">4096</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;bit length&quot;</span>, primes_n.bit_length())</span><br><span class="line">            primes_arr.clear()</span><br><span class="line">            primes_n = <span class="number">1</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Create public key &#x27;n&#x27;</span></span><br><span class="line">    n = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> primes_arr:</span><br><span class="line">        n *= j</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] Public Key: &quot;</span>, n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[+] size: &quot;</span>, n.bit_length(), <span class="string">&quot;bits&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Calculate totient &#x27;Phi(n)&#x27;</span></span><br><span class="line">    phi = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> primes_arr:</span><br><span class="line">        phi *= (k - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Calculate private key &#x27;d&#x27;</span></span><br><span class="line">    d = <span class="built_in">pow</span>(config.e, -<span class="number">1</span>, phi)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Generate Flag</span></span><br><span class="line">    <span class="keyword">assert</span> config.flag.startswith(<span class="string">b&quot;CTF&#123;&quot;</span>)</span><br><span class="line">    <span class="keyword">assert</span> config.flag.endswith(<span class="string">b&quot;&#125;&quot;</span>)</span><br><span class="line">    enc_flag = bytes_to_long(config.flag)</span><br><span class="line">    <span class="keyword">assert</span> enc_flag &lt; n</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Encrypt Flag</span></span><br><span class="line">    _enc = <span class="built_in">pow</span>(enc_flag, config.e, n)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span> (<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> flag_file:</span><br><span class="line">        flag_file.write(_enc.to_bytes(n.bit_length(), <span class="string">&quot;little&quot;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Export RSA Key</span></span><br><span class="line">    rsa = RSA.construct((n, config.e))</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span> (<span class="string">&quot;public.pem&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> pub_file:</span><br><span class="line">        pub_file.write(rsa.exportKey().decode())</span><br></pre></td></tr></table></figure>
<p>çœ‹å®Œä»£ç ï¼Œé¢˜ç›®ç»™äº†LCGçš„å‰å…­ç»„ï¼Œå¯ä»¥æ ¹æ®è¿™å…­ç»„é€ä¸ªè¿˜åŸLCGçš„å‚æ•°ï¼Œæ ¹æ®é¢˜ç›®RSAç”Ÿæˆä»£ç ç›´æ¥è§£å°±è¡Œï¼Œç”Ÿæˆè´¨æ•°éƒ¨åˆ†ç›´æ¥å¤åˆ¶ç²˜è´´å³å¯ï¼š</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">s = [</span><br><span class="line">    <span class="number">2166771675595184069339107365908377157701164485820981409993925279512199123418374034275465590004848135946671454084220731645099286746251308323653144363063385</span>,</span><br><span class="line">    <span class="number">6729272950467625456298454678219613090467254824679318993052294587570153424935267364971827277137521929202783621553421958533761123653824135472378133765236115</span>,</span><br><span class="line">    <span class="number">2230396903302352921484704122705539403201050490164649102182798059926343096511158288867301614648471516723052092761312105117735046752506523136197227936190287</span>,</span><br><span class="line">    <span class="number">4578847787736143756850823407168519112175260092601476810539830792656568747136604250146858111418705054138266193348169239751046779010474924367072989895377792</span>,</span><br><span class="line">    <span class="number">7578332979479086546637469036948482551151240099803812235949997147892871097982293017256475189504447955147399405791875395450814297264039908361472603256921612</span>,</span><br><span class="line">    <span class="number">2550420443270381003007873520763042837493244197616666667768397146110589301602119884836605418664463550865399026934848289084292975494312467018767881691302197</span>,</span><br><span class="line">]</span><br><span class="line">seed = <span class="number">211286818345627549183608678726370412218029639873054513839005340650674982169404937862395980568550063504804783328450267566224937880641772833325018028629959635</span></span><br><span class="line"></span><br><span class="line">x0, x1, x2, x3, x4, x5 = s[<span class="number">0</span>], s[<span class="number">1</span>], s[<span class="number">2</span>], s[<span class="number">3</span>], s[<span class="number">4</span>], s[<span class="number">5</span>]</span><br><span class="line">t0, t1, t2, t3, t4 = x1 - x0, x2 - x1, x3 - x2, x4 - x3, x5 - x4</span><br><span class="line">p = gmpy2.gcd(</span><br><span class="line">    gmpy2.gcd(t3 * t1 - t2 * t2, t2 * t0 - t1 * t1),</span><br><span class="line">    gmpy2.gcd(t4 * t2 - t3 * t3, t3 * t1 - t2 * t2),</span><br><span class="line">)</span><br><span class="line">a = (x2 - x1) * gmpy2.invert((x1 - x0), p) % p</span><br><span class="line">b = (x1 - a * x0) % p</span><br><span class="line">seed = gmpy2.invert(a, p) * (s[<span class="number">0</span>] - b) % p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LCG</span>:</span><br><span class="line">    lcg_m = a</span><br><span class="line">    lcg_c = b</span><br><span class="line">    lcg_n = p</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, lcg_s</span>):</span><br><span class="line">        self.state = lcg_s</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">        self.state = (self.state * self.lcg_m + self.lcg_c) % self.lcg_n</span><br><span class="line">        <span class="keyword">return</span> self.state</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lcg = LCG(seed)</span><br><span class="line">primes_arr = []</span><br><span class="line">dump = <span class="literal">True</span></span><br><span class="line">items = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">primes_n = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            prime_candidate = lcg.<span class="built_in">next</span>()</span><br><span class="line">            <span class="keyword">if</span> dump:</span><br><span class="line">                <span class="built_in">print</span>(prime_candidate)</span><br><span class="line">                items += <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> items == <span class="number">6</span>:</span><br><span class="line">                    dump = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> isPrime(prime_candidate):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">elif</span> prime_candidate.bit_length() != <span class="number">512</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                primes_n *= prime_candidate</span><br><span class="line">                primes_arr.append(prime_candidate)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> primes_n.bit_length() &gt; <span class="number">4096</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;bit length&quot;</span>, primes_n.bit_length())</span><br><span class="line">        primes_arr.clear()</span><br><span class="line">        primes_n = <span class="number">1</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">phi = <span class="number">1</span></span><br><span class="line">n = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> primes_arr:</span><br><span class="line">    phi *= k - <span class="number">1</span></span><br><span class="line">    n *= k</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">d = gmpy2.invert(e, phi)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f = f.read()[::-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(bytes_to_long(f), d, n)))</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ç¬¬ä¸€æ¬¡åšæ²¡åšå‡ºæ¥ï¼Œå‘ç°flagæ–‡ä»¶çš„äºŒè¿›åˆ¶å­—èŠ‚è¢«åè½¬äº†ï¼Œå†<code>[::-1]</code>åè½¬å›æ¥æ‰èƒ½è§£å‡ºæ¥ã€‚</p>
</blockquote>
<h1 id="å·…å³°æå®¢2023"><a href="#å·…å³°æå®¢2023" class="headerlink" title="å·…å³°æå®¢2023"></a>å·…å³°æå®¢2023</h1><h2 id="æ•°å­¦ä½†é«˜ä¸­"><a href="#æ•°å­¦ä½†é«˜ä¸­" class="headerlink" title="æ•°å­¦ä½†é«˜ä¸­"></a>æ•°å­¦ä½†é«˜ä¸­</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">x=4&#123;0<span class="language-xml">&lt;y&lt;6&#125;</span></span><br><span class="line"><span class="language-xml">y=4&#123;2&lt;x&lt;6,17&lt;x&lt;18,28&lt;x&lt;30,41&lt;x&lt;42&#125;</span></span><br><span class="line"><span class="language-xml">y=6&#123;4&lt;x&lt;6,15&lt;x&lt;16,17&lt;x&lt;19,41&lt;x&lt;43,50&lt;x&lt;51&#125;</span></span><br><span class="line"><span class="language-xml">x=7&#123;0&lt;y&lt;6&#125;</span></span><br><span class="line"><span class="language-xml">(x-9)^2+(y-3)^2=1</span></span><br><span class="line"><span class="language-xml">x=10&#123;2&lt;y&lt;3&#125;</span></span><br><span class="line"><span class="language-xml">(x-12)^2+(y-3)^2=1</span></span><br><span class="line"><span class="language-xml">x=13&#123;0&lt;y&lt;3&#125;</span></span><br><span class="line"><span class="language-xml">y=0&#123;11&lt;x&lt;13,15&lt;x&lt;16,50&lt;x&lt;51&#125;</span></span><br><span class="line"><span class="language-xml">y=-x+17&#123;14&lt;x&lt;15&#125;</span></span><br><span class="line"><span class="language-xml">y=x-11&#123;14&lt;x&lt;15&#125;</span></span><br><span class="line"><span class="language-xml">x=15&#123;0&lt;y&lt;2,4&lt;y&lt;6&#125;</span></span><br><span class="line"><span class="language-xml">x=17&#123;1&lt;y&lt;6&#125;</span></span><br><span class="line"><span class="language-xml">x=19&#123;3&lt;y&lt;4&#125;</span></span><br><span class="line"><span class="language-xml">x=21&#123;3&lt;y&lt;4&#125;</span></span><br><span class="line"><span class="language-xml">(x-20)^2+(y-3)^2=1&#123;2&lt;y&lt;3&#125;</span></span><br><span class="line"><span class="language-xml">(x-23)^2+(y-3)^2=1&#123;3&lt;y&lt;4&#125;</span></span><br><span class="line"><span class="language-xml">x=22&#123;2&lt;y&lt;3&#125;</span></span><br><span class="line"><span class="language-xml">x=24&#123;2&lt;y&lt;3&#125;</span></span><br><span class="line"><span class="language-xml">(x-26)^2+(y-3)^2=1&#123;25&lt;x&lt;26&#125;</span></span><br><span class="line"><span class="language-xml">y=0.5x-11&#123;26&lt;x&lt;27&#125;</span></span><br><span class="line"><span class="language-xml">y=-0.5x+17&#123;26&lt;x&lt;27&#125;</span></span><br><span class="line"><span class="language-xml">y=2&#123;29&lt;x&lt;30,31&lt;x&lt;33,39&lt;x&lt;40&#125;</span></span><br><span class="line"><span class="language-xml">x=29&#123;2&lt;y&lt;5&#125;</span></span><br><span class="line"><span class="language-xml">x=32&#123;2&lt;y&lt;5&#125;</span></span><br><span class="line"><span class="language-xml">y=x-27&#123;31&lt;x&lt;32&#125;</span></span><br><span class="line"><span class="language-xml">(x-34)^2+((y-3.5)^2)/(1.5^2)=1</span></span><br><span class="line"><span class="language-xml">x=36&#123;2&lt;y&lt;3&#125;</span></span><br><span class="line"><span class="language-xml">(x-37)^2+(y-3)^2=1&#123;3&lt;y&lt;4&#125;</span></span><br><span class="line"><span class="language-xml">x=38&#123;2&lt;y&lt;3&#125;</span></span><br><span class="line"><span class="language-xml">x=41&#123;2&lt;y&lt;6&#125;</span></span><br><span class="line"><span class="language-xml">x=44&#123;3&lt;y&lt;4&#125;</span></span><br><span class="line"><span class="language-xml">(x-45)^2+(y-3)^2=1&#123;2&lt;y&lt;3&#125;</span></span><br><span class="line"><span class="language-xml">x=46&#123;3&lt;y&lt;4&#125;</span></span><br><span class="line"><span class="language-xml">x=47&#123;2&lt;y&lt;3&#125;</span></span><br><span class="line"><span class="language-xml">(x-48)^2+(y-3)^2=1&#123;3&lt;y&lt;4&#125;</span></span><br><span class="line"><span class="language-xml">x=49&#123;2&lt;y&lt;3&#125;</span></span><br><span class="line"><span class="language-xml">x=51&#123;0&lt;y&lt;2,4&lt;y&lt;6&#125;</span></span><br><span class="line"><span class="language-xml">y=x-49&#123;51&lt;x&lt;52&#125;</span></span><br><span class="line"><span class="language-xml">y=-x+55&#123;51&lt;x&lt;52&#125;</span></span><br></pre></td></tr></table></figure>
<p>ç»™äº†ä¸€å †å‡½æ•°æ›²çº¿ä¹‹ç±»çš„ä¸œè¥¿ï¼ŒçŒœæµ‹æ˜¯ç”»å›¾çš„flagï¼Œç”¨å‡ ä½•ç”»æ¿geogebraåº”è¯¥å°±å¯ä»¥ï¼Œä¸è¿‡æš‚æ—¶æ²¡ç ”ç©¶æ˜ç™½å‡ ä½•ç”»æ¿æ€ä¹ˆç©ï¼Œå°±ç›´æ¥æ‰‹æ“äº†ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2023/07/22/m9c7MG6ezB8btJ2.jpg" alt="d8bc2706e3267869793ce5dc0f8cddf6.jpeg"></p>
<h2 id="Simple-encryption"><a href="#Simple-encryption" class="headerlink" title="Simple_encryption"></a>Simple_encryption</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = getStrongPrime(<span class="number">1024</span>)</span><br><span class="line">q = getStrongPrime(<span class="number">1024</span>)</span><br><span class="line">N = p * q</span><br><span class="line">g, r1, r2 = [getRandomRange(<span class="number">1</span>, N) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">g1 = <span class="built_in">pow</span>(g, r1 * (p - <span class="number">1</span>), N)</span><br><span class="line">g2 = <span class="built_in">pow</span>(g, r2 * (q - <span class="number">1</span>), N)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">m</span>):</span><br><span class="line">    s1, s2 = [getRandomRange(<span class="number">1</span>, N) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br><span class="line">    c1 = (m * <span class="built_in">pow</span>(g1, s1, N)) % N</span><br><span class="line">    c2 = (m * <span class="built_in">pow</span>(g2, s2, N)) % N</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;c1=&quot;</span>, c1)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;c2=&quot;</span>, c2)</span><br><span class="line">    <span class="keyword">return</span> (c1, c2)</span><br><span class="line"></span><br><span class="line">c = encrypt(bytes_to_long(flag[:<span class="built_in">len</span>(flag) // <span class="number">2</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;N=&#x27;</span>, N)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;g1=&#x27;</span>, g1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">msg, length</span>):</span><br><span class="line">    l = <span class="built_in">len</span>(msg)</span><br><span class="line">    <span class="keyword">return</span> msg + (length - l) * <span class="built_in">chr</span>(length - l).encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = getStrongPrime(<span class="number">1024</span>)</span><br><span class="line">q = getStrongPrime(<span class="number">1024</span>)</span><br><span class="line"><span class="keyword">assert</span> (p != q)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">5</span></span><br><span class="line">d = inverse(e, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line"><span class="keyword">assert</span> (e * d % (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">flag = pad(flag[<span class="built_in">len</span>(flag) // <span class="number">2</span>:], <span class="number">48</span>)</span><br><span class="line">m = [<span class="built_in">int</span>(binascii.b2a_hex(flag[i * <span class="number">16</span>:i * <span class="number">16</span> + <span class="number">16</span>]).decode(<span class="string">&#x27;utf-8&#x27;</span>), <span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;S=&#x27;</span>, <span class="built_in">sum</span>(m) % n)</span><br><span class="line">cnt = <span class="built_in">len</span>(m)</span><br><span class="line">A = [(i + <span class="number">128</span>) ** <span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(cnt)]</span><br><span class="line">B = [(i + <span class="number">1024</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(cnt)]</span><br><span class="line">C = [(i + <span class="number">512</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(cnt)]</span><br><span class="line">Cs = [<span class="built_in">int</span>(<span class="built_in">pow</span>((A[i] * m[i] ** <span class="number">2</span> + B[i] * m[i] + C[i]), e, n)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(cnt)]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;N=&#x27;</span>, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;e=&#x27;</span>, e)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Cs=&#x27;</span>, Cs)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">c1= 19024563955839349902897822692180949371550067644378624199902067434708278125346234824900117853598997270022872667319428613147809325929092749312310446754419305096891122211944442338664613779595641268298482084259741784281927857614814220279055840825157115551456554287395502655358453270843601870807174309121367449335110327991187235786798374254470758957844690258594070043388827157981964323699747450405814713722613265012947852856714100237325256114904705539465145676960232769502207049858752573601516773952294218843901330100257234517481221811887136295727396712894842769582824157206825592614684804626241036297918244781918275524254</span></span><br><span class="line"><span class="string">c2= 11387447548457075057390997630590504043679006922775566653728699416828036980076318372839900947303061300878930517069527835771992393657157069014534366482903388936689298175411163666849237525549902527846826224853407226289495201341719277080550962118551001246017511651688883675152554449310329664415179464488725227120033786305900106544217117526923607211746947511746335071162308591288281572603417532523345271340113176743703809868369623401559713179927002634217140206608963086656140258643119596968929437114459557916757824682496866029297120246221557017875892921591955181714167913310050483382235498906247018171409256534124073270350</span></span><br><span class="line"><span class="string">N= 21831630625212912450058787218272832615084640356500740162478776482071876178684642739065105728423872548532056206845637492058465613779973193354996353323494373418215019445325632104575415991984764454753263189235376127871742444636236132111097548997063091478794422370043984009615893441148901566420508196170556189546911391716595983110030778046242014896752388438535131806524968952947016059907135882390507706966746973544598457963945671064540465259211834751973065197550500334726779434679470160463944292619173904064826217284899341554269864669620477774678605962276256707036721407638013951236957603286867871199275024050690034901963</span></span><br><span class="line"><span class="string">g1= 20303501619435729000675510820217420636246553663472832286487504757515586157679361170332171306491820918722752848685645096611030558245362578422584797889428493611704976472409942840368080016946977234874471779189922713887914075985648876516896823599078349725871578446532134614410886658001724864915073768678394238725788245439086601955497248593286832679485832319756671985505398841701463782272300202981842733576006152153012355980197830911700112001441621619417349747262257225469106511527467526286661082010163334100555372381681421874165851063816598907314117035131618062582953512203870615406642787786668571083042463072230605649134</span></span><br><span class="line"><span class="string">S= 234626762558445335519229319778735528295</span></span><br><span class="line"><span class="string">N= 28053749721930780797243137464055357921262616541619976645795810707701031602793034889886420385567169222962145128498131170577184276590698976531070900776293344109534005057067680663813430093397821366071365221453788763262381958185404224319153945950416725302184077952893435265051402645871699132910860011753502307815457636525137171681463817731190311682277171396235160056504317959832747279317829283601814707551094074778796108136141845755357784361312469124392408642823375413433759572121658646203123677327551421440655322226192031542368496829102050186550793124020718643243789525477209493783347317576783265671566724068427349961101</span></span><br><span class="line"><span class="string">e= 5</span></span><br><span class="line"><span class="string">Cs= [1693447496400753735762426750097282582203894511485112615865753001679557182840033040705025720548835476996498244081423052953952745813186793687790496086492136043098444304128963237489862776988389256298142843070384268907160020751319313970887199939345096232529143204442168808703063568295924663998456534264361495136412078324133263733409362366768460625508816378362979251599475109499727808021609000751360638976, 2240772849203381534975484679127982642973364801722576637731411892969654368457130801503103210570803728830063876118483596474389109772469014349453490395147031665061733965097301661933389406031214242680246638201663845183194937353509302694926811282026475913703306789097162693368337210584494881249909346643289510493724709324540062077619696056842225526183938442535866325407085768724148771697260859350213678910949, 5082341111246153817896279104775187112534431783418388292800705085458704665057344175657566751627976149342406406594179073777431676597641200321859622633948317181914562670909686170531929552301852027606377778515019377168677204310642500744387041601260593120417053741977533047412729373182842984761689443959266049421034949822673159561609487404082536872314636928727833394518122974630386280495027169465342976]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>flagåˆ†äº†ä¸¤éƒ¨åˆ†åŠ å¯†ã€‚</p>
<p>å‰éƒ¨åˆ†å…ˆåˆ©ç”¨è´¹é©¬å°å®šç†è®¡ç®—å¾—åˆ°$g_2$å’Œ$p$ï¼š</p>
<script type="math/tex; mode=display">
\begin{cases}g_1=g^{r_1(p-1)}\bmod N\\g_2=g^{r_2(q-1)}\bmod N\end{cases}</script><script type="math/tex; mode=display">
g_1g_2=g^{k\phi(n)}\bmod N=1</script><script type="math/tex; mode=display">
g^{r_1(p-1)}\bmod p=1\Rightarrow g^{r_1(p-1)}-1=tp</script><p>ç„¶åå˜æ¢ä¸€ä¸‹åŒä½™æ–¹ç¨‹ç»„è¿˜æ˜¯åˆ©ç”¨è´¹é©¬å°å®šç†ä½¿å…¶èƒ½ä½¿ç”¨ä¸­å›½å‰©ä½™å®šç†æ±‚è§£$m_1$ï¼š</p>
<script type="math/tex; mode=display">
\begin{cases}c_1 = mg_1^{s_1} \bmod  N=mg^{r_1s_1(p-1)}\bmod N\\c_2 = mg_2^{s_2}\bmod  N=mg^{r_2s_2(q-1)}\bmod N\end{cases}</script><script type="math/tex; mode=display">
\begin{cases}c_1 \bmod p=m\bmod p\\c_2\bmod q = m\bmod q\end{cases}</script><p>åéƒ¨åˆ†$e$è¿‡å°ç›´æ¥å¼€æ ¹ååˆ†åˆ«æ±‚è§£ä¸‰ä¸ªä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹ï¼ŒABCå‚æ•°éƒ½ç»™äº†æ‰€ä»¥ç›´æ¥è§£å°±è¡Œï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">N= <span class="number">21831630625212912450058787218272832615084640356500740162478776482071876178684642739065105728423872548532056206845637492058465613779973193354996353323494373418215019445325632104575415991984764454753263189235376127871742444636236132111097548997063091478794422370043984009615893441148901566420508196170556189546911391716595983110030778046242014896752388438535131806524968952947016059907135882390507706966746973544598457963945671064540465259211834751973065197550500334726779434679470160463944292619173904064826217284899341554269864669620477774678605962276256707036721407638013951236957603286867871199275024050690034901963</span></span><br><span class="line">g1= <span class="number">20303501619435729000675510820217420636246553663472832286487504757515586157679361170332171306491820918722752848685645096611030558245362578422584797889428493611704976472409942840368080016946977234874471779189922713887914075985648876516896823599078349725871578446532134614410886658001724864915073768678394238725788245439086601955497248593286832679485832319756671985505398841701463782272300202981842733576006152153012355980197830911700112001441621619417349747262257225469106511527467526286661082010163334100555372381681421874165851063816598907314117035131618062582953512203870615406642787786668571083042463072230605649134</span></span><br><span class="line">c1= <span class="number">19024563955839349902897822692180949371550067644378624199902067434708278125346234824900117853598997270022872667319428613147809325929092749312310446754419305096891122211944442338664613779595641268298482084259741784281927857614814220279055840825157115551456554287395502655358453270843601870807174309121367449335110327991187235786798374254470758957844690258594070043388827157981964323699747450405814713722613265012947852856714100237325256114904705539465145676960232769502207049858752573601516773952294218843901330100257234517481221811887136295727396712894842769582824157206825592614684804626241036297918244781918275524254</span></span><br><span class="line">c2= <span class="number">11387447548457075057390997630590504043679006922775566653728699416828036980076318372839900947303061300878930517069527835771992393657157069014534366482903388936689298175411163666849237525549902527846826224853407226289495201341719277080550962118551001246017511651688883675152554449310329664415179464488725227120033786305900106544217117526923607211746947511746335071162308591288281572603417532523345271340113176743703809868369623401559713179927002634217140206608963086656140258643119596968929437114459557916757824682496866029297120246221557017875892921591955181714167913310050483382235498906247018171409256534124073270350</span></span><br><span class="line"></span><br><span class="line">g2=gmpy2.invert(g1,N)</span><br><span class="line">p=gmpy2.gcd(g1-<span class="number">1</span>,N)</span><br><span class="line">q=N//p</span><br><span class="line">phi=(p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">cp = c1 % p</span><br><span class="line">cq = c2 % q</span><br><span class="line">m = solve_crt([cp,cq],[p,q])</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m).decode(),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">res=[]</span><br><span class="line">Cs= [<span class="number">1693447496400753735762426750097282582203894511485112615865753001679557182840033040705025720548835476996498244081423052953952745813186793687790496086492136043098444304128963237489862776988389256298142843070384268907160020751319313970887199939345096232529143204442168808703063568295924663998456534264361495136412078324133263733409362366768460625508816378362979251599475109499727808021609000751360638976</span>, </span><br><span class="line">     <span class="number">2240772849203381534975484679127982642973364801722576637731411892969654368457130801503103210570803728830063876118483596474389109772469014349453490395147031665061733965097301661933389406031214242680246638201663845183194937353509302694926811282026475913703306789097162693368337210584494881249909346643289510493724709324540062077619696056842225526183938442535866325407085768724148771697260859350213678910949</span>, </span><br><span class="line">     <span class="number">5082341111246153817896279104775187112534431783418388292800705085458704665057344175657566751627976149342406406594179073777431676597641200321859622633948317181914562670909686170531929552301852027606377778515019377168677204310642500744387041601260593120417053741977533047412729373182842984761689443959266049421034949822673159561609487404082536872314636928727833394518122974630386280495027169465342976</span>]</span><br><span class="line">res.append(<span class="built_in">int</span>(gmpy2.iroot(Cs[<span class="number">0</span>],<span class="number">5</span>)[<span class="number">0</span>]))</span><br><span class="line">res.append(<span class="built_in">int</span>(gmpy2.iroot(Cs[<span class="number">1</span>],<span class="number">5</span>)[<span class="number">0</span>]))</span><br><span class="line">res.append(<span class="built_in">int</span>(gmpy2.iroot(Cs[<span class="number">2</span>],<span class="number">5</span>)[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params"><span class="built_in">list</span></span>):</span><br><span class="line">    A = [(i + <span class="number">128</span>) ** <span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">    B = [(i + <span class="number">1024</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">    C = [(i + <span class="number">512</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">    get = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        get.append((-B[i]+gmpy2.iroot(<span class="built_in">int</span>(B[i]**<span class="number">2</span>-<span class="number">4</span>*A[i]*(C[i]-<span class="built_in">list</span>[i])),<span class="number">2</span>)[<span class="number">0</span>])//(<span class="number">2</span>*A[i]))</span><br><span class="line">    <span class="keyword">return</span> get</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(long_to_bytes(<span class="built_in">int</span>(i)).decode() <span class="keyword">for</span> i <span class="keyword">in</span> solve(res)))</span><br></pre></td></tr></table></figure>
<h1 id="DASCTF-2023ä¸ƒæœˆ"><a href="#DASCTF-2023ä¸ƒæœˆ" class="headerlink" title="DASCTF 2023ä¸ƒæœˆ"></a>DASCTF 2023ä¸ƒæœˆ</h1><h2 id="ezDHKE"><a href="#ezDHKE" class="headerlink" title="ezDHKE"></a>ezDHKE</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randbytes, getrandbits</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">diffie_hellman</span>(<span class="params">g, p, flag</span>):</span><br><span class="line">    alice = getrandbits(<span class="number">1024</span>)</span><br><span class="line">    bob = getrandbits(<span class="number">1024</span>)</span><br><span class="line">    alice_c = <span class="built_in">pow</span>(g, alice, p)</span><br><span class="line">    bob_c = <span class="built_in">pow</span>(g, bob, p)</span><br><span class="line">    <span class="built_in">print</span>(alice_c , bob_c)</span><br><span class="line">    key = sha256(long_to_bytes(<span class="built_in">pow</span>(bob_c, alice, p))).digest()</span><br><span class="line">    iv = <span class="string">b&quot;dasctfdasctfdasc&quot;</span></span><br><span class="line">    aes = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    enc = aes.encrypt(flag)</span><br><span class="line">    <span class="built_in">print</span>(enc)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getp</span>():</span><br><span class="line">    p = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;P = &quot;</span>))</span><br><span class="line">    <span class="keyword">assert</span> isPrime(p)</span><br><span class="line">    <span class="keyword">assert</span> p.bit_length() &gt;= <span class="number">1024</span> <span class="keyword">and</span> p.bit_length() &lt;= <span class="number">2048</span></span><br><span class="line">    g = <span class="number">2</span></span><br><span class="line">    diffie_hellman(g, p, flag)</span><br><span class="line"></span><br><span class="line">getp()</span><br></pre></td></tr></table></figure>
<p>ä¸€é“DHï¼Œä¼ ä¸€ä¸ªç¬¦åˆè¦æ±‚çš„$p$ï¼Œé¦–å…ˆæƒ³åˆ°äº†ç”¨$p-1$å…‰æ»‘æ•°ï¼š</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    p = <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> p.bit_length() &lt; <span class="number">1024</span>:</span><br><span class="line">        p *= getPrime(<span class="number">16</span>)</span><br><span class="line">    <span class="keyword">if</span> p.bit_length() &lt; <span class="number">2048</span>:</span><br><span class="line">        p = p + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> isPrime(p):</span><br><span class="line">        <span class="built_in">print</span>(p)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Failed&#x27;</span>)</span><br><span class="line">        </span><br><span class="line"><span class="comment">#1667833661893190850614229728242541473293090915587516195377451154299565854036707919099882497009094106528670113622582165967857335570266503881754097306871220357984103872808513913944395982281681516153048594439559300291842285061839022871314628039891098410917621542562195094231722413980078436853725372342624712803167</span></span><br></pre></td></tr></table></figure>
<p>å‘é€ï¼Œå¾—åˆ°äº†$AB$å’Œ$enc$ï¼Œsageçš„<code>discrete_log</code>çš„ç®—æ³•åŒ…å«äº†Pohligâ€“Hellmançš„å…‰æ»‘æ•°ç®—æ³•ï¼Œåˆ†è§£å¾—åˆ°$a$ï¼Œå³å¯æ±‚å‡ºkeyï¼Œè§£å¯†å¾—åˆ°flagï¼š</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"></span><br><span class="line">p=<span class="number">1667833661893190850614229728242541473293090915587516195377451154299565854036707919099882497009094106528670113622582165967857335570266503881754097306871220357984103872808513913944395982281681516153048594439559300291842285061839022871314628039891098410917621542562195094231722413980078436853725372342624712803167</span></span><br><span class="line">A=<span class="number">674338210175916971040145932562399337979803757873940643305779230227023770048277289379616197311090576212146354324600042151827768489913436479730502970022683944021451855725712384135519384435844299034886947385743994245307535983614074769003902403120531577386321567969843754563629583882687720501366639876370403334063</span> </span><br><span class="line">B=<span class="number">1496405443110435697016942653655407798903378252274283459115580396855258014491004374918548812118652923231512011132623305747438339133524052501013037935697029275845589904549107374889754485778123275792581689009825019096968528611330186767295673567032691651711760660150612951284828461266305440640100176699756442139271</span></span><br><span class="line">enc=<span class="string">b&#x27;\tQZ`\xf4\x85e\xc0\x04\x08\xde\xa6\xcb\x08A\x95\x8b\x12\x80\xab\xd0\xe0\xbb\xf9\xce\x05\xab\xffh\x1cl\xb6\xe4VX\x06\xf8\xd2\xed\x81\xf2\x8c&#123;\x9em\x06\x91\xc8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;F = IntegerModRing(p)</span></span><br><span class="line"><span class="string">a = discrete_log(F(A), F(2))</span></span><br><span class="line"><span class="string">print(a)&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">a=<span class="number">134637600312404672552619474452519856417289889351153359861331867871723205226426976036720937904922831097464189207651306439726793719056104318275311370416324895329262529016160530522778176631604479645395601484474144732115675519021324643356649512302139842899207009059468554963266614619707715509022572109298910737558</span></span><br><span class="line"></span><br><span class="line">key = sha256(long_to_bytes(<span class="built_in">pow</span>(B, a, p))).digest()</span><br><span class="line">iv = <span class="string">b&quot;dasctfdasctfdasc&quot;</span></span><br><span class="line">aes = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">flag = aes.decrypt(enc)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<h2 id="ezRSAï¼ˆèµ›åï¼‰"><a href="#ezRSAï¼ˆèµ›åï¼‰" class="headerlink" title="ezRSAï¼ˆèµ›åï¼‰"></a>ezRSAï¼ˆèµ›åï¼‰</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> secret, flag</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="keyword">assert</span> flag == <span class="string">b&quot;dasctf&#123;&quot;</span> + secret + <span class="string">b&quot;&#125;&quot;</span></span><br><span class="line">e = <span class="number">11</span></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q</span><br><span class="line">P = getPrime(<span class="number">512</span>)</span><br><span class="line">Q = getPrime(<span class="number">512</span>)</span><br><span class="line">N = P * Q</span><br><span class="line">gift = P ^ (Q &gt;&gt; <span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(N, gift, <span class="built_in">pow</span>(n, e, N))</span><br><span class="line"><span class="built_in">print</span>(encrypt(bytes_to_long(secret)),</span><br><span class="line">    encrypt(bytes_to_long(flag)))</span><br><span class="line"></span><br><span class="line">N = <span class="number">75000029602085996700582008490482326525611947919932949726582734167668021800854674616074297109962078048435714672088452939300776268788888016125632084529419230038436738761550906906671010312930801751000022200360857089338231002088730471277277319253053479367509575754258003761447489654232217266317081318035524086377</span></span><br><span class="line">gift = <span class="number">8006730615575401350470175601463518481685396114003290299131469001242636369747855817476589805833427855228149768949773065563676033514362512835553274555294034</span></span><br><span class="line">c1 = <span class="number">14183763184495367653522884147951054630177015952745593358354098952173965560488104213517563098676028516541915855754066719475487503348914181674929072472238449853082118064823835322313680705889432313419976738694317594843046001448855575986413338142129464525633835911168202553914150009081557835620953018542067857943</span></span><br><span class="line">c2 = <span class="number">69307306970629523181683439240748426263979206546157895088924929426911355406769672385984829784804673821643976780928024209092360092670457978154309402591145689825571209515868435608753923870043647892816574684663993415796465074027369407799009929334083395577490711236614662941070610575313972839165233651342137645009</span></span><br><span class="line">c3 = <span class="number">46997465834324781573963709865566777091686340553483507705539161842460528999282057880362259416654012854237739527277448599755805614622531827257136959664035098209206110290879482726083191005164961200125296999449598766201435057091624225218351537278712880859703730566080874333989361396420522357001928540408351500991</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„åˆ°è¿™é‡Œçš„$gift=P\oplus (Q&lt;&lt;16)$ï¼Œæä¾›äº†$gift$ï¼Œç›¸å½“äºçŸ¥é“äº†$P$çš„å‰16ä½ï¼Œå¯ä»¥æ ¹æ®äºŒè¿›åˆ¶çš„ä¹˜æ³•è¿˜åŸå‡º$Q$çš„æœ€å¼€å§‹çš„å‡ ä½ï¼ˆç”±äºéœ€è¦è€ƒè™‘è¿›ä½ï¼Œæ‰€ä»¥å¯ä»¥å°‘å–å‡ ä½ï¼‰ï¼ŒçŸ¥é“$Q$çš„å‰$x$ä½ä¹‹åæ ¹æ®å¼‚æˆ–å¯ä»¥å¾—åˆ°$P$çš„$16+x$ä½ï¼Œç„¶åæŒ‰ç…§è¿™ç§æ–¹æ³•ä¸æ–­å¾ªç¯å°±å¯ä»¥å¤§è‡´æ±‚å‡º$P$ï¼Œç”±äº$Q$çš„æœ€å16ä½ä¸çŸ¥é“ï¼Œæ‰€ä»¥$P$æ±‚åˆ°æœ€åä¼šå·®å‡ ä½ï¼Œç›´æ¥çˆ†ç ´å³å¯ï¼š</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">N = <span class="number">75000029602085996700582008490482326525611947919932949726582734167668021800854674616074297109962078048435714672088452939300776268788888016125632084529419230038436738761550906906671010312930801751000022200360857089338231002088730471277277319253053479367509575754258003761447489654232217266317081318035524086377</span></span><br><span class="line">gift = <span class="number">8006730615575401350470175601463518481685396114003290299131469001242636369747855817476589805833427855228149768949773065563676033514362512835553274555294034</span></span><br><span class="line">e=<span class="number">11</span></span><br><span class="line"></span><br><span class="line">p_high = gift &gt;&gt;(<span class="number">512</span>-<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        q_high = (N&gt;&gt;(<span class="number">1024</span> - p_high.bit_length()*<span class="number">2</span>))//p_high &gt;&gt; <span class="number">6</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;q_solve =&#x27;</span>,q_high,q_high.bit_length())</span><br><span class="line">        gifts = gift^(q_high&lt;&lt;(<span class="number">512</span>-<span class="number">16</span>-q_high.bit_length()))</span><br><span class="line">        p_high = gifts &gt;&gt; (<span class="number">512</span>-<span class="number">16</span>-q_high.bit_length())</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;p_solve =&#x27;</span>,p_high,p_high.bit_length())</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">    P = (p_high &lt;&lt; <span class="number">6</span>) + i</span><br><span class="line">    <span class="keyword">if</span> N % P == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(P)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">Q = N//P</span><br><span class="line"><span class="built_in">print</span>(P,Q)</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œæ¢å¤<code>n</code>çš„æ—¶å€™æœ‰ä¸€ä¸ªå‘çš„åœ°æ–¹ï¼š<code>print(N, gift, pow(n, e, N))</code></p>
<p>è¿™é‡Œçš„<code>n</code>å¦‚æœæœ¬æ¥æ¯”<code>N</code>è¿˜å¤§çš„è¯ï¼Œæˆ‘ä»¬æ±‚é€†å¾—åˆ°çš„<code>n</code>å°±ä¸å¯¹äº†ï¼Œéœ€è¦å†åŠ ä¸Šä¸€ä¸ª<code>N</code>ã€‚</p>
<p>è¿™é¢˜è¿˜è€ƒäº†ä¸€ç§ç›¸å…³ä¿¡æ¯æ”»å‡»ï¼š</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span> flag == <span class="string">b&quot;dasctf&#123;&quot;</span> + secret + <span class="string">b&quot;&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(encrypt(bytes_to_long(secret)),</span><br><span class="line">    encrypt(bytes_to_long(flag)))</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¾—åˆ°çš„ä¸¤ä¸ªå¯†æ–‡çš„æ˜æ–‡ä¸åŒï¼Œè€Œä¸”è¿™ä¸¤ä¸ªæ˜æ–‡æœ‰äº›è”ç³»ï¼ˆbytesæ˜¯256ä¸€ä½ï¼‰ï¼š</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag = bytes_to_long(<span class="string">b&#x27;dasctf&#123;&#x27;</span> + <span class="string">b&#x27;\x00&#x27;</span> * i + <span class="string">b&#x27;&#125;&#x27;</span>) + <span class="number">256</span> * secret</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå°±å¯ä»¥ä½¿ç”¨Franklin-Reiterç›¸å…³æ¶ˆæ¯æ”»å‡»ï¼šå¦‚æœä¸¤ä¸ªä¿¡æ¯ä¹‹é—´å­˜åœ¨å·²çŸ¥çš„å›ºå®šå·®å¼‚ï¼ˆ$f(x)=ax+b$ï¼‰ï¼Œå¹¶ä¸”åœ¨ç›¸åŒçš„æ¨¡æ•°$n$ä¸‹è¿›è¡ŒRSAåŠ å¯†ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½æ¢å¤å‡ºè¿™ä¸¤ä¸ªæ¶ˆæ¯ã€‚</p>
<p>æœ‰ï¼š</p>
<script type="math/tex; mode=display">
C_1\equiv M_1^e(\bmod N)</script><script type="math/tex; mode=display">
C_2\equiv M_2^e(\bmod N)</script><script type="math/tex; mode=display">
M_1\equiv f(M_2)(\bmod N)</script><p>å¯ä»¥çŸ¥é“$M_2$æ˜¯$f(x)^e-C_1\equiv 0(\bmod N)$çš„ä¸€ä¸ªè§£ï¼Œä¹Ÿæ˜¯$x^e-C_2\equiv 0(\bmod N)$çš„è§£ï¼Œå¯¹ä¸¤ä¸ªå¤šé¡¹å¼åˆ†åˆ«è¿›è¡Œè¾—è½¬ç›¸é™¤æ³•æ±‚å¾—å¤šé¡¹å¼çš„æœ€å¤§å…¬å› å­ï¼Œå¦‚æœæœ€å¤§å…¬å› å­æ˜¯çº¿æ€§çš„ï¼ˆæ¬¡æ•°ä¸º1ï¼‰ï¼Œå³æœ€å¤§å…¬å› å­å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªä¸€æ¬¡å¤šé¡¹å¼ï¼ˆ$x-M_2$ï¼‰ï¼Œé‚£ä¹ˆåœ¨æ¨¡æ•°ä¸‹ä»æ»¡è¶³$x-M_2=0$ï¼Œå°±æ±‚å¾—äº†$M_2$ï¼š</p>
<blockquote>
<p>è¿™ä¸ªé¢˜ä¸­æ²¡å‘Šè¯‰flagçš„é•¿åº¦ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œçˆ†ç ´ï¼Œæ‰¾åˆ°ç¬¦åˆé•¿åº¦çš„secretã€‚</p>
</blockquote>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">N = <span class="number">75000029602085996700582008490482326525611947919932949726582734167668021800854674616074297109962078048435714672088452939300776268788888016125632084529419230038436738761550906906671010312930801751000022200360857089338231002088730471277277319253053479367509575754258003761447489654232217266317081318035524086377</span></span><br><span class="line">c1 = <span class="number">14183763184495367653522884147951054630177015952745593358354098952173965560488104213517563098676028516541915855754066719475487503348914181674929072472238449853082118064823835322313680705889432313419976738694317594843046001448855575986413338142129464525633835911168202553914150009081557835620953018542067857943</span></span><br><span class="line">c2 = <span class="number">69307306970629523181683439240748426263979206546157895088924929426911355406769672385984829784804673821643976780928024209092360092670457978154309402591145689825571209515868435608753923870043647892816574684663993415796465074027369407799009929334083395577490711236614662941070610575313972839165233651342137645009</span></span><br><span class="line">c3 = <span class="number">46997465834324781573963709865566777091686340553483507705539161842460528999282057880362259416654012854237739527277448599755805614622531827257136959664035098209206110290879482726083191005164961200125296999449598766201435057091624225218351537278712880859703730566080874333989361396420522357001928540408351500991</span></span><br><span class="line">P=<span class="number">8006847171912577069085166877758626954304824756138758266557706391662987806065132448544117840031499707938227955094109779732609035310252723066470330862622641</span></span><br><span class="line">Q=<span class="number">9366986529377069783394625848920106951220134111548343265311677163992169555436421569730703291128771472885865288798344038000984911921843088200997725324682297</span></span><br><span class="line"></span><br><span class="line">phi=(P-<span class="number">1</span>)*(Q-<span class="number">1</span>)</span><br><span class="line">d=gmpy2.invert(<span class="number">11</span>,phi)</span><br><span class="line">n=<span class="built_in">int</span>(<span class="built_in">pow</span>(c1,d,N))+N</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GCD</span>(<span class="params">a,b</span>):</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> a.monic()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> GCD(b,a % b)</span><br><span class="line">    </span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    f1 = x ^ <span class="number">11</span> - c2</span><br><span class="line">    f2 = (bytes_to_long(<span class="string">b&#x27;dasctf&#123;&#x27;</span> + <span class="string">b&#x27;\x00&#x27;</span> * i + <span class="string">b&#x27;&#125;&#x27;</span>) + <span class="number">256</span> * x) ^ <span class="number">11</span> - c3</span><br><span class="line">    <span class="keyword">if</span> GCD(f1,f2)[<span class="number">0</span>] != <span class="number">1</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">b&#x27;DASCTF&#123;&#x27;</span>+long_to_bytes(<span class="built_in">int</span>(n - GCD(f1,f2)[<span class="number">0</span>]))+<span class="string">b&#x27;&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h1 id="NepCTF-2023"><a href="#NepCTF-2023" class="headerlink" title="NepCTF 2023"></a>NepCTF 2023</h1><p>æ‰“æ¯”èµ›ä¸¤å¤©æ¯”è¾ƒå¿™ï¼Œå°±åšäº†å‡ ä¸ªmiscï¼Œè¿‡äº†ä¸€éå¯†ç çš„å‡ ä¸ªé¢˜ï¼Œæ„Ÿè§‰æ¯”è¾ƒå¤æ‚ä¹Ÿæ²¡åšå‡ºæ¥ï¼Œèµ›åå¤ç°ä¸€ä¸‹å§ã€‚</p>
<h2 id="random-RSAï¼ˆèµ›åï¼‰"><a href="#random-RSAï¼ˆèµ›åï¼‰" class="headerlink" title="random_RSAï¼ˆèµ›åï¼‰"></a>random_RSAï¼ˆèµ›åï¼‰</h2><p>è¿™é¢˜å­¦é•¿ä»¿ç€æ ¡èµ›çš„é‚£é“é¢˜å‡ºçš„ï¼š</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> next_prime, invert <span class="keyword">as</span> inverse_mod</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_v1_5</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> getrandbits</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> lcm</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> exit</span><br><span class="line">flag = <span class="string">&quot;1234&quot;</span></span><br><span class="line">global_bits = <span class="number">1024</span></span><br><span class="line"></span><br><span class="line">BANNER = <span class="string">rb&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">.--------.--------.--------.--------.--------.--------.--------.--------.--------.--------.--------.</span></span><br><span class="line"><span class="string">| N.--.  | E.--.  | P.--.  | C.--.  | T.--.  | F.--.  | H.--.  | A.--.  | P.--.  | P.--.  | Y.--.  |</span></span><br><span class="line"><span class="string">|  :/\:  |  (\/)  |  :():  |  :/\:  |  :/\:  |  :/\:  |  (\/)  |  :():  |  :/\:  |  :/\:  |  (\/)  |</span></span><br><span class="line"><span class="string">|  :\/:  |  :\/:  |  ()()  |  (__)  |  :\/:  |  (__)  |  :\/:  |  ()()  |  :\/:  |  :\/:  |  :\/:  |</span></span><br><span class="line"><span class="string">|  &#x27;--&#x27;n |  &#x27;--&#x27;e |  &#x27;--&#x27;p |  &#x27;--&#x27;c | &#x27;--&#x27;t  |  &#x27;--&#x27;f |  &#x27;--&#x27;h |  &#x27;--&#x27;a |  &#x27;--&#x27;p |  &#x27;--&#x27;p |  &#x27;--&#x27;y |</span></span><br><span class="line"><span class="string">`--------`--------`--------`--------&#x27;--------`--------`--------`--------`--------`--------`--------`</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_prime</span>(<span class="params">bits: <span class="built_in">int</span></span>):</span><br><span class="line">    p = (getrandbits(bits - <span class="number">32</span>) &lt;&lt; <span class="number">32</span>)</span><br><span class="line">    <span class="keyword">return</span> next_prime(p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_private_key</span>(<span class="params">bits: <span class="built_in">int</span></span>):</span><br><span class="line">    p, q = generate_prime(bits), generate_prime(bits)</span><br><span class="line">    n, phi = p * q, lcm(p-<span class="number">1</span>, q - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    d = inverse_mod(<span class="number">0x10001</span>, phi)</span><br><span class="line">    privateKey = RSA.construct((<span class="built_in">int</span>(n), <span class="built_in">int</span>(<span class="number">0x10001</span>), <span class="built_in">int</span>(d), <span class="built_in">int</span>(p), <span class="built_in">int</span>(q)))</span><br><span class="line">    <span class="keyword">return</span> privateKey, p &gt; q</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(BANNER.decode())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Welcome to the world of random RSA.&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Please make your choice.&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        choice = <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> choice == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            p, q = generate_prime(global_bits), generate_prime(global_bits)</span><br><span class="line">            N = p*q</span><br><span class="line">            d = generate_prime(global_bits-<span class="number">32</span>)</span><br><span class="line">            e = inverse_mod(d, (p * p - <span class="number">1</span>) * (q * q - <span class="number">1</span>))</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;<span class="built_in">int</span>(N)&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;<span class="built_in">int</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> choice == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">            privateKey, signal = generate_private_key(global_bits)</span><br><span class="line">            Cipher = PKCS1_v1_5.new(privateKey)</span><br><span class="line">            c = (Cipher.encrypt(flag.encode()))</span><br><span class="line">            <span class="built_in">print</span>(c)</span><br><span class="line">            exit()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            exit()</span><br></pre></td></tr></table></figure>
<p>è¿˜è®°å¾—ä¹‹å‰é‚£ä¸ªæ˜¯è§£ä¸€ä¸ªäºŒå…ƒçš„åŒä½™æ–¹ç¨‹ï¼Œè¿™é‡Œæœ€å¤§çš„å˜åŒ–å°±æ˜¯<code>e = inverse_mod(d, (p * p - 1) * (q * q - 1))</code>ï¼Œé—®é¢˜å°±æ˜¯å¦‚ä½•åˆ†è§£æ¨¡æ•°ï¼Œå½“æ—¶æƒ³åˆ°äº†ç”¨è¿åˆ†æ•°æ”»å‡»ï¼Œä½†æ˜¯å…·ä½“æ€ä¹ˆä¸ªæ”»å‡»æ³•ä¸æ˜¯å¾ˆæ¸…æ¥šã€‚</p>
<p>ä¾ç…§è®ºæ–‡ã€ŠCryptanalysis of RSA Variants with Primes Sharing Most Significant Bitsã€‹ï¼Œå¦‚æœå‡ºç°ä¸Šè¿°è¿™ç§æƒ…å†µï¼Œå¯ä»¥å¯»æ‰¾$\frac e{N^2-\frac 94N+1}$çš„è¿åˆ†æ•°æ¥æ¢å¤ï¼Œä½†æ˜¯ä¸ç¡®å®šè°æ‰æ˜¯çœŸæ­£çš„$p,q$ï¼Œæ‰€ä»¥åç»­è¿˜éœ€è¦æ’åˆ—ç»„åˆä¸€ä¸‹ï¼Œç”¨åˆ°itertoolsï¼š</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2, itertools</span><br><span class="line"><span class="keyword">from</span> extend_mt19937_predictor <span class="keyword">import</span> ExtendMT19937Predictor</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_v1_5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">attack</span>(<span class="params">N, e</span>):</span><br><span class="line">    convergents = continued_fraction(</span><br><span class="line">        ZZ(e) / ZZ(<span class="built_in">int</span>(N ^ <span class="number">2</span> - <span class="number">9</span> / <span class="number">4</span> * N + <span class="number">1</span>))</span><br><span class="line">    ).convergents()</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> convergents:</span><br><span class="line">        k = c.numerator()</span><br><span class="line">        d = c.denominator()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">pow</span>(<span class="built_in">pow</span>(<span class="number">3</span>, e, N), d, N) == <span class="number">3</span>:</span><br><span class="line">            phi = -(((e * d - <span class="number">1</span>) // k) - N ^ <span class="number">2</span> - <span class="number">1</span>)</span><br><span class="line">            paddq = gmpy2.iroot(phi + <span class="number">2</span> * N, <span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">            psubq = gmpy2.iroot(phi - <span class="number">2</span> * N, <span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">            p = (paddq + psubq) // <span class="number">2</span></span><br><span class="line">            q = N // p</span><br><span class="line">            <span class="keyword">return</span> p, q, d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_prime</span>(<span class="params">bits: <span class="built_in">int</span></span>):</span><br><span class="line">    p = predictor.predict_getrandbits(bits - <span class="number">32</span>) &lt;&lt; <span class="number">32</span></span><br><span class="line">    <span class="keyword">return</span> gmpy2.next_prime(p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">N = [</span><br><span class="line">    <span class="number">3765304535291018339688670915896633223049145240557925608076814531580764601506094555625235870930145344445034517999252187810691525051945406571449198399619338466719394096327909343739405114412183218693874257550201904795355429473491452123232766685889958978508746764937033934388116453314906550166251190689334987889491070284034342757231103113370747651109695929056916132220291521767583483907419454636178829846508861417282419720051506489452559583486366763002184149965303026016285269557063844163561975102092475685056717839708800504657083102707802580204551750511621130061415762082460977670712101611396626771712322664347191591323</span>,</span><br><span class="line">    <span class="number">334632136453190551723081253576634900585632232582351643743083954002337465509647787170466132811539860248177158778004387142610580971591037048596232650016811454798468939369216327233665888745787309521420145465526350988305057386068795286538656425850578290878785540725823927498178793582332746795954290315983108734928238954557771729784933864761834378886910250682621647463849692985037254423294379442111428114361697295170408409335579777444340902948267852779645089648331867542798646589899493486600774662691287670728444012563200203019555388567168417631932353770160592775673303986571920660111230813531455512751129063668773513109</span>,</span><br><span class="line">    <span class="number">153715361735531965272821019242034854365280672797974694129828808729014207544226656645669155433599719460128954317891729222286388189452981947447380976396847669367257109336893730334936811298996103788918912412912043950379358514115443236390609791034492613165873862174762235838535786107756803285722732838308106005141864996466534888774468262171576492016835324319614101186714978118794877295234334199529077228105563893755774687121271124614388739875586056852744030880217275042784137847103955364431665506050736429068076969468715027611207720808285712884312343701689446175985259810861442589445293961929665727922966218183322643991</span>,</span><br><span class="line">    <span class="number">7649717688029700473239198357034068317967619332212148096452918919648108665367993684191395637339881295124789979477813114571304026387696234426797430312923723594276296427130133329160615089210594195951349573695228331695856018211030704956236879259959060767496927003079483843839671238825390589720292050579154663187413209114288105669626034344187663390952882022858881130145243345550538078765358856064008966837923926711059067447250716386545271352390379483873001929689366607348000025669596978953090522217641996833642841588178606558699901723390995785457730729333619815170514232673742237928630790953027996105498037232590249039053</span>,</span><br><span class="line">    <span class="number">7457883801163318826405526150112579893417970974020504629242561157019113562804326849056156724208041137150533505739990407109077810321379027208498635880118205061287061395091326582299965612518833703906054294223411569962057620128373567861629262515342618228686329309087490239995091051782509922379844038225275527471556782395090408119191145356046868082594514442233628660461363025205838524451347467219223874599977669916216761453909322037149880021461652885858294699892505782091039442283103866451823909748022667639157470807593475928084573431819134127451933080773075137409421894801075502546925802480677875398545074012657587083983</span>,</span><br><span class="line">    <span class="number">1813559865513707653055230789285394341068979896078084508620368892013433949432881330199380116711706246678749889981127822085668163618236713915766210705689701980478991012628265976347772668333610539935853260290619179387341574042594172518938365835338645385754536560978089330755372236415605247266194763503664269455613236672427228340880941257837044509918038846090085398979381440302492083140216039768579678674528911253979612107665221688844691527767527990967852442304087733243427802719885743703095217136758377532888713160271848900361056757404771363206535372378132469622112276980219190857006925965234174026305359802656998075507</span>,</span><br><span class="line">    <span class="number">7018714901781695384238187379808766296980529575242596207509988571386042720510190906033962914089587542321597146267822149170716062102747855091099966952060196851723837834296127483395022712980320508963622409883161512764519326190222180028853293641307178142216866231601275942050561361155279891771536614243714775716528212034586465344158653077046696967782965191150213340212327271906507086443578451292626475752484105108868575454796993931340872669661915188373097848902310691046138927368076970570810771118232622158738069820111765539883905999343012765450489465671547836075707793564844796888036950048848507258710529880264456978619</span>,</span><br><span class="line">]</span><br><span class="line">e = [</span><br><span class="line">    <span class="number">7366635133308336189637831170384977836694264065634288360782746681326026297216918144435268356839986329412631551102171723870848568250180640846873268887544893980743655417665429613006480641821611959115150610131631997610859583816756488548344610003758128917472080126202962327383161648551011064990697767956767472049832671456988295454144759407234813474643273809970367987827847266778100704999783911394747787301777842452473022977096245346638355373000494166315823619498502378907047100855589473263443951302510454613614983242245800645329663435353005808792350476867223672426590467266835459205773816473065872621629673198924341827557728013243915088499026124523782987667142132477895764920539939507207353238795917175516314439317092385480353961218037528632048486067720233854136080717362331246003376272401028793301533330671567657462006801304529117039359033778564055875922710253333294537580848418065626762714333393039578727146089661205775274959881174012565531583329784901510977285670219486315816574707789882703969465007261361489834017650782755027941718045416163757882301850400042695516981001126394034504199507705256624781636475771083820163864860374904204911524107828720122664050988746498116525887186921001186002841984524856520198482943690729004126660921</span>,</span><br><span class="line">    <span class="number">94128072103270544951761402955477278111051543608438514758901351962833421943552478491923160953899926984993441526458840100770089599190409413056841943442762751453182808592549095710666764100401297184026498293763116408957038287034783169276109375171325443967585089408588889123392861474515089975351355715014873957785709823059505216584491364723523777962800736875685886145967042501770771010353645526815781190868685491413708468500044583816520413444859597957679234728895746683882329109516255194251627086368635222785163613602067942222275954398741292510652497216260759315102799270730570057482299559163775882617217232865604831277534942547520261997183276811422360490310900065272033105183443079240913227758075087805190322107074510398773100826247013649620116662383596359811675364585322445916610384787640339868669269740427124031395984902562057215023860139550320616690249547247265226575487771330255741909554198423847144232099418778379936760002750988381603672141060338805465754103845139990394724807262930354399826150465799234313903415692707692976069815806280427872412127793196019406170839184674500319860928479357681340068484714538705389893385426065178209049195830495435297499510761574613780019492063731579226927073605056117291419683409392049330971823</span>,</span><br><span class="line">    <span class="number">29938063184059722715836999348619662986820135033368134003129093184173608756932914388044521740170608273027242136864259821779104436118568148403788177717328830595583737498486887906888560528834325661017012794171293970925583418678260928809108732689876846497038817246787118385305171360347425199280597715576469636790661054178989848430107476444714096401838226928214846051627286476574909009273483730730012288546052530276330894267716266745627741009284487213534718087971712602071958046826812382205771458576996864103588271971596790249677095953627593334412463850833489619552252343282747368818498069106583587605936110466543236641337733986372616490128771270037318029295526720464846272707640922638627490023654806921863041129160366134147012441282747942112730928156294563806100579406040860206834742347455124192175765073693535133433726826087284560529586906379233113040876231121306168504426137650360219839202066444812239528700595764259739637679999346648586419813783208237545399496930176977510947867694568696631805236201456363731190760715702203618533010370718095402914775029801127359591465235479277045419287968366021347122345151133939671594722532621651937782632644262303086385203676978486055708096210363092859204384197567441018742862151535970325337</span>,</span><br><span class="line">    <span class="number">22242172854585820599771662231592135629751522579639384363017295649354179258540837582192678551261478534817526103751356207632266517773788143978894768283914893074296403964361516953031986661282387169902902535358664567926936825360973679103096277022192787735748224582088404373210870415913820650112391908457926220868627735802109994277210310855252396517414737341249433266949112137432454061526723592625800128275224241458730876411426745366095007972516091808988655185242608456785522411174191402418788882796392602094168822213397414257594609535315883650826937231541186302618473269968221787628515707656683197829845204584651244564409925017557748404665245114204388073154508062825060580937679948691946470970869780179376161489990421844330828497260883720644434965422904462494280431467574058723863274857471578587737940376570627084337626796997657894669390826331922603006644476839037111712478349475688502469769526441362990812411526026624169858951937609629375908999078962140488526530740367562675194715226591821981283130422727934114396560118408257639910141264943252774851742665125020744570778742697643990313512839806290767261082249187798760344853462439103270401917156234795879795105282539611541934241424322659622229924460215744836224481608055159779743891987</span>,</span><br><span class="line">    <span class="number">7935615333069344782550539080941744675593939286007591806958487750116455093837758943332661795018117645405322945287360502547714067960330003996294422504519564856822194551811994978801231251098003986519255919363241998506462063103796728895961090408270022455411603822641748971036706146621484486295585515477441489806261439608644649762562513119493095475170095127417410517420787742785388934924579731549107151524103783767890440593038050282713737692611258633613657821822467920242288790623615344622917861947040259939856758241913324151661414068729477840408936676268167083119822980915296470563794025717830932052269161506002100339702645483713444167574328181603708212563968150962069592753517717694739742703771558250327523154239821714610178994360221447477312770517347344847983552480167418359788823492240370769817576172497026241084878337132715849711575903280189585243898482522149325072004522335879516642946384395900345695909934720374459649295906802294897306955307332924772477005157532973972805811022695414167456651071085278818794683137465359363826659476597616083578688497724940359644989023798286621568142435839062768662707551346343320329475307624112737666579693619188245048304660114861603079309309906389607022001946114684324398813253984267000150449967</span>,</span><br><span class="line">    <span class="number">164724742790494775261806711902276018852469305976720859409992192118979621017192706934453787196309379727807740686567971193919929247419416656051955584733517291983922220811147189636365583006175675685867895166384041231418660233425269784822683023982868367336461160261357885815057437191381325707013115691868167182889623537400280169466347243568341980940531165363947802792350736208622531893909030212981202061889029667561981343223354931082143735651763422536056585282624582109691889044446565401146791777356484506977971115457721083173263530811413473382253083088839270825223648329240595182922955231624401667918881846728505950552932462386207919655853390200335159403012521370804355985901891290495715180317670061786323129472077797590492412938087856426015959862474998241506854722331607708219119363019823810742043846432997686478760894912937632501674926117888376911841803296269856441628429583230676724046015818594654307075665650706617870752947616176198560533861603328528466934953028273077415032887804128677899096254680630160929802757955287574180750511398727169378406799693874163420293859206378391315266233060040950102157257909070415812338079166735695989281160785311568513529536573169484406961016221730267933252984924458858639187568330955438813921231</span>,</span><br><span class="line">    <span class="number">17631067554479313247175539183573165403651771719391212375552951497482733701531879295053654972862370420307478530333423283283339230687444658611058338898747209254721511878220884711382776185948963570286590254046127244582703841617586703300834269582420905510071198658574511645218534243787971248573898538325170359581014724146045446555423520128022960649353505292887267766015269849277635652613379264899709526743934171351524702625023029545450707299611235121884301408414240419067636254667709006178036318547812268693365895023967775094797356574685901479155795893507350398597837862943649394206733123791896702643404795188321640355451822009099798580695247380884654850072379378488636749779394790480431646139855704812950274333857881195457921766323086829756991115536472758486891359850784642602550336091379314327213881503972612955893916970540759324873445367953100990902180867720579319469979496854377815266948828355784276218615788119887319338297250290703777062452841834910860553945587516526316450911753847957857781076883365550303848768938610995133633322599352370461958641183301525550866404920866795789962368579912955476640915658361379954039470514512106817656941903974607746786227905914277329203896740138916825540218493120873046564279638394784252295619323</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">c = <span class="string">b&quot;.\xbfm\x80k*\x0f&#123;\x05aZ\xa2_\x86\xbf\x8e\xd9\xce&#x27;\xcc\xf5\xaa5\xff[i\xf9Li\x11:\xd8Mz\x85\xa7GL\xeb\xc3\x83\xd2*\xf4\xf5\xc4\x08iu\x8b\xc4\x11v\xcb\xc8\xa3\xfbVB\xe5\x07:\x18\xa6\xfd[\x92\xeb\xd2\xe6B\xc7j\xb7\x88\xb8\xf9\xe7\xf3\xe0E\xa6\x03\x1e\xfa\x84\xd7\xf0\xfe\xf3\xb8\xe2\xf4`h\xc3\x1a\xbf\x83\xb3|\xb6_\xe0\x87\x11a\xedl\x868\xe0\x8cl\x93\x8a`F/O\xb5&#125;%\x93\xb7z\xb6\xb2\x96\xdd\xc7\xe4\xd1(D\x9b\x7f\xa0\xea\xce\x11\xb2\x96\xec\xbd\x94\x96`Y=V\x08@X\x91\x8e\x84?\xeb\xba\xed\x95\x00\x14\xe5\xbc\x87\xc7r\xb1`_77\x8e\x82\x96Z\x07GFhkm\&quot;nO\x0c\xbb\xf3.\xb3\x0b\xd4\xef\xb0YYy`9\x95\xb4\xdc\xdd\x06\r\xb8\xeel\x066@?\xbcx\x101 ^n\x05\xb6\x98\x81ek\x1b!\r,;\x98\x96\xeaR\x1d\xe5U\x9e\x89\xca\xa7\xbe\xca\x12\xcb\xaf\x05\xd5\x05YM\x97\x8a\xa5&quot;</span></span><br><span class="line"></span><br><span class="line">P = []</span><br><span class="line">Q = []</span><br><span class="line">D = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    p, q, d = attack(N[i], e[i])</span><br><span class="line">    P.append(<span class="built_in">int</span>(p &gt;&gt; <span class="number">32</span>))</span><br><span class="line">    Q.append(<span class="built_in">int</span>(q &gt;&gt; <span class="number">32</span>))</span><br><span class="line">    D.append(d &gt;&gt; <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> itertools.product([<span class="number">0</span>, <span class="number">1</span>], repeat=<span class="number">7</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        fac = []</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(i)):</span><br><span class="line">            <span class="keyword">if</span> i[j] == <span class="number">1</span>:</span><br><span class="line">                fac.append(P[j])</span><br><span class="line">                fac.append(Q[j])</span><br><span class="line">                fac.append(D[j])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                fac.append(Q[j])</span><br><span class="line">                fac.append(P[j])</span><br><span class="line">                fac.append(D[j])</span><br><span class="line"></span><br><span class="line">        predictor = ExtendMT19937Predictor()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(fac)):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">int</span>(fac[i]).bit_length() &lt; <span class="number">965</span>:</span><br><span class="line">                predictor.setrandbits(fac[i], <span class="number">960</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                predictor.setrandbits(fac[i], <span class="number">992</span>)</span><br><span class="line"></span><br><span class="line">        p, q = generate_prime(<span class="number">1024</span>), generate_prime(<span class="number">1024</span>)</span><br><span class="line">        n, phi = p * q, lcm(p - <span class="number">1</span>, q - <span class="number">1</span>)</span><br><span class="line">        d = inverse_mod(<span class="number">0x10001</span>, phi)</span><br><span class="line">        privateKey = RSA.construct((<span class="built_in">int</span>(n), <span class="built_in">int</span>(<span class="number">0x10001</span>), <span class="built_in">int</span>(d), <span class="built_in">int</span>(p), <span class="built_in">int</span>(q)))</span><br><span class="line">        Cipher = PKCS1_v1_5.new(privateKey)</span><br><span class="line">        flag = Cipher.decrypt(c, <span class="string">&quot;\x00&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h1 id="WMCTF"><a href="#WMCTF" class="headerlink" title="WMCTF"></a>WMCTF</h1><h2 id="signin"><a href="#signin" class="headerlink" title="signin"></a>signin</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_prime</span>(<span class="params">bit</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        P = getPrime(bit)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(<span class="built_in">bin</span>(P)) - <span class="number">2</span> == bit:</span><br><span class="line">            <span class="keyword">return</span> P</span><br><span class="line"></span><br><span class="line">pq_bit = <span class="number">512</span></span><br><span class="line">offset = <span class="number">16</span></span><br><span class="line"></span><br><span class="line">P,Q = [gen_prime(pq_bit) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br><span class="line">N = P * Q</span><br><span class="line">gift = <span class="built_in">int</span>(<span class="built_in">bin</span>(P ^ (Q &gt;&gt; offset))[<span class="number">2</span>+offset:],<span class="number">2</span>)</span><br><span class="line">pr(N)</span><br><span class="line">pr(gift)</span><br><span class="line"></span><br><span class="line">inpP = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line"><span class="keyword">if</span> inpP != P:</span><br><span class="line">    pr(<span class="string">b&quot;you lose!&quot;</span>)</span><br><span class="line">    exit()</span><br><span class="line"></span><br><span class="line">secret = randrange(<span class="number">0</span>,P)</span><br><span class="line">bs = [randrange(<span class="number">0</span>,P) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">38</span>)]</span><br><span class="line"></span><br><span class="line">results = [(bi * secret) % P <span class="keyword">for</span> bi <span class="keyword">in</span> bs]</span><br><span class="line">rs = [ri &amp; (<span class="number">2</span> ** offset - <span class="number">1</span>)  <span class="keyword">for</span> ri <span class="keyword">in</span> results]</span><br><span class="line"></span><br><span class="line">pr(bs)</span><br><span class="line">pr(rs)</span><br><span class="line">inpsecret = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line"><span class="keyword">if</span> inpsecret == secret:</span><br><span class="line">    pr(flag)</span><br></pre></td></tr></table></figure>
<p>è¿™é¢˜åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸ŠåŠæ˜¯ä¸€ä¸ªç±»ä¼¼äºä¸Šé¢ezRSAçš„æ±‚è§£å› å­çš„æ“ä½œï¼Œä¸è¿‡è¿™é‡Œæ²¡æœ‰æä¾›é«˜ä½ï¼Œå¯ä»¥ç›´æ¥çˆ†ç ´ä¸€ä¸‹ï¼š</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">N = <span class="number">56926121230070860522021858222376835199152768535695893312307107271470069724930276796319823573131233195237160028777740480344562965515093909280322054086785487388103390618832318336984744202378593597183981582538471590847113343740046218768605691018126706982690057576771999872413555389254225943044818790534983211867</span></span><br><span class="line">gift = <span class="number">179855635362202401189637654527305278267838051491985548013479645843896448045963084621418188187077860016324803214638232902394544150770345050212854238842</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32768</span>, <span class="number">65535</span>):</span><br><span class="line">    gg = gift + (h &lt;&lt; (<span class="number">512</span> - <span class="number">16</span>))</span><br><span class="line">    p_high = gg &gt;&gt; (<span class="number">512</span> - <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            q_high = (N &gt;&gt; (<span class="number">1024</span> - p_high.bit_length() * <span class="number">2</span>)) // p_high &gt;&gt; <span class="number">6</span></span><br><span class="line">            gifts = gg ^ (q_high &lt;&lt; (<span class="number">512</span> - <span class="number">16</span> - q_high.bit_length()))</span><br><span class="line">            p_high = gifts &gt;&gt; (<span class="number">512</span> - <span class="number">16</span> - q_high.bit_length())</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**<span class="number">6</span>):</span><br><span class="line">            P = (p_high &lt;&lt; <span class="number">6</span>) + i</span><br><span class="line">            <span class="keyword">if</span> N % P == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span>(P, N // P)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>å¾—åˆ°$pq$ä¹‹åå‘é€ï¼Œä¼šå¾—åˆ°å‘æ¥çš„ä¸¤ä¸ªæ•°ç»„ï¼š</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">secret = randrange(<span class="number">0</span>,P)</span><br><span class="line">bs = [randrange(<span class="number">0</span>,P) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">38</span>)]</span><br><span class="line"></span><br><span class="line">results = [(bi * secret) % P <span class="keyword">for</span> bi <span class="keyword">in</span> bs]</span><br><span class="line">rs = [ri &amp; (<span class="number">2</span> ** offset - <span class="number">1</span>)  <span class="keyword">for</span> ri <span class="keyword">in</span> results]</span><br><span class="line"></span><br><span class="line">pr(bs)</span><br><span class="line">pr(rs)</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œéœ€è¦æ±‚è§£ä¸€ä¸ªsecretï¼Œæœç´¢å‘ç°å±äºæ ¼å¯†ç çš„HNPé—®é¢˜ï¼š</p>
<script type="math/tex; mode=display">
2^{16}k_i\equiv b_is-r_i(\bmod p)</script><script type="math/tex; mode=display">
2^{-16}b_is-2^{-16}r_i\equiv k_i(\bmod p)</script><p>é¢˜ç›®æ¯”è¾ƒå¸¸è§„ï¼Œæ‰¾äº†é“å·®ä¸å¤šçš„é¢˜ç›®æ”¹äº†æ”¹ï¼š</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">11097356886714303582042893881171986567091401868447229878503047789761897485022302260317124893493702691228364525570373590910056115747877840029999866380610223</span></span><br><span class="line"></span><br><span class="line">bs = [<span class="number">5387698015877849837882921423342017708155444190335961820405722215335852977335390820857481585434449016636335952770723311768916733799089117289205218502419606</span>, <span class="number">650471216782011759645022062640509711926996735020251275978971345507642644564075094156062031600261942496607624723929246244735618107358089176591848004348391</span>, <span class="number">6892903057178860129386688215569774798856400351014017060703886147768553739624962487481469668471625433585233788376496342110607517705509446954467327981630608</span>, <span class="number">10558146217032686084780873566925952381406930468404116116883569742913909418317825029965832918484884762403282735413753206846274765419932064337450818984248054</span>, <span class="number">5895415442088304335075372438017932133885868509444667400284843896831303957528388054288887813996402038199111852177790699136545463857579658675903340447062163</span>, <span class="number">5429024410614963379865219259975147383629950413248077865390569915021231258663758271426436460389815769323236013664720331435963974964648287965544449065269796</span>, <span class="number">9026061660318029970583789958687022405333849900223149905948914743741240152082556310642216826239157255360498393220970025247084970629707295326151787097739470</span>, <span class="number">9987787428206816995850349762789606634812404454347812646058676687395659473474197306399216159790010449792477748167622035909410465377793292190006286746423274</span>, <span class="number">2219882147954108708840577265969694482093318909707767606354094905609717560942016128151728113851186281314135963004282045018374113530058586118814069243919529</span>, <span class="number">448757898952195794732591529111692253250164310530502726405668619180155713699029254781106387718875294003380948759606096353377052975496257750540980902200778</span>, <span class="number">5758653512060580754844348908481795573915995758307454610577312717012029063801642812799241752795878752846316566511482026158363885685586463754255822907693695</span>, <span class="number">451407923140660945242455996808809564152178783574163893129896751571955655419694047302205795680988585534903177540569006476372988386974713491023439929159026</span>, <span class="number">633230505240984785152032107199697607142942221176494363282719218090842541716845224386067665579315266043773982412795676744597305708356598867728704864589776</span>, <span class="number">1873190106392837354104400680537195411114254251102350148513372284223841924186325948790777253558186704552585713605684421787221410972907036097255365624473450</span>, <span class="number">2378344617083543424448032167509636924990155019932249453905019078602008117706158987527488527042698261839476468330013047487417876731137315873798888588470222</span>, <span class="number">2041490918666445400155338029718590811728321100435361255475667686435257229236970377627380175478356582980165642805265465423479765728673033124872546566385586</span>, <span class="number">5562161572200618028354345987299340111930078299847265710086174356409817095136403822321442138703607136459753226468060755767359990809912165191525799668695194</span>, <span class="number">5747234564119121785321011246727969704422611840072385774157664049108853751368346706805693382579294969825994862268640942182569121253716853132907345764307939</span>, <span class="number">8711521062723349590043059489855073535946052234990913757437890347386107248179336560218502066046421074197588333654807876448053668867474787637034338684918646</span>, <span class="number">3315012579877772110918215314158524960614627244604284637905444215220273580285487157686581740829048820736622528444258472998857688206632723701316565735733441</span>, <span class="number">5546154726961135678231117496318693445209508601072296509072183409019567463552371689350178057966104310171589572056336776559176855351086359177629932234196550</span>, <span class="number">3210029904188905528418762865762860869303323377258665972527427212116198548111352207058446069365253354674921968880673880399786725395578776350248179308628748</span>, <span class="number">10843936556611444261236981575784285818543127684649594185908397301964934586327913247825082747331673594235701670093030132266375809586461029560547000376976259</span>, <span class="number">6109998016677649914877201823404560484970816089875676710769267944367498990120567697221448844101964580968840400803344669148726692092294926446783659619214576</span>, <span class="number">5845789000584380610984539779605991403432667349729999673859641615898065218110678683119040475240751804243020389180781027199152636556329114964903206159902529</span>, <span class="number">2978206364062142507924182683147186917280271225942784082942105053728393144909546285722973282439828908940095850686786079027997116957290187820185190955763478</span>, <span class="number">6172828045950561259361364955607904722730989822468578500079867327320412590167223290116851092240394293157176976858784303537724018502930568835611443150651565</span>, <span class="number">7276734264264156394849232946266365251451947245412208586150565621876731163850573337504381487556687197688905647923429178659520220297621303831067919313410263</span>, <span class="number">3174250935189051073896846162393872594492003965678114695568417093691366243434525958022465816335752281251528544505448643745253787429411926831986289204883674</span>, <span class="number">6093691251666218937687383630438296270086788146989761585751750001923551024830181398231345750563441889348377747370613585331834029372443912918336983092300186</span>, <span class="number">10096646446971081026853706495186301279465296233138748560834746144164615654055150736814340732777289692486966572132768416035838287881181678294741435773964909</span>, <span class="number">8910382579772641305873435379231059340173429305417698402532090276346045435768234779190862149435094577890323386387056525014327144178759659119217204400714683</span>, <span class="number">3933072529238941268900040999537821261948444537912919914446421661923109677382310237583616922988592740560036795345194304129614194476572206993895859654990035</span>, <span class="number">5297616631647713320273614376028978020531793358568039411666823922639911828340747099895808672237065841708616332085783027624376509371773096431136618023286834</span>, <span class="number">5257516673290708095813773480275744141704872613428524210965419462561140237627111403201960099316667611246891201897039938627093157883750555046439973809189882</span>, <span class="number">10258024129168788280748704276949204673517069302816996431976512552153603914212946110648682507216486336629396614508777344247540495198173116870062239473007726</span>, <span class="number">109420448594931913569612908119015744722217665784121695843519143728750932074310599152460322892779794568077023248786450716381443084154979030492351498361925</span>, <span class="number">4748868717171457081934731961849037503853518293108190435095345896237075826383529119745072366847766895101020323142681923650076340134187570278669989702218781</span>]</span><br><span class="line"></span><br><span class="line">rs = [<span class="number">3315</span>, <span class="number">30170</span>, <span class="number">9642</span>, <span class="number">18143</span>, <span class="number">17691</span>, <span class="number">48991</span>, <span class="number">58031</span>, <span class="number">41460</span>, <span class="number">5285</span>, <span class="number">39039</span>, <span class="number">62495</span>, <span class="number">22239</span>, <span class="number">1453</span>, <span class="number">59877</span>, <span class="number">22876</span>, <span class="number">60799</span>, <span class="number">26800</span>, <span class="number">16142</span>, <span class="number">63558</span>, <span class="number">27836</span>, <span class="number">26849</span>, <span class="number">57671</span>, <span class="number">1866</span>, <span class="number">45222</span>, <span class="number">55869</span>, <span class="number">40139</span>, <span class="number">18220</span>, <span class="number">21401</span>, <span class="number">27625</span>, <span class="number">36526</span>, <span class="number">31195</span>, <span class="number">45689</span>, <span class="number">43974</span>, <span class="number">45140</span>, <span class="number">45960</span>, <span class="number">31932</span>, <span class="number">18782</span>, <span class="number">25973</span>]</span><br><span class="line"></span><br><span class="line">A = []</span><br><span class="line">B = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(bs)):</span><br><span class="line">    A.append(<span class="built_in">int</span>(bs[i] * gmpy2.invert(<span class="number">2</span>**<span class="number">16</span>, p)))</span><br><span class="line">    B.append(<span class="built_in">int</span>(-rs[i] * gmpy2.invert(<span class="number">2</span>**<span class="number">16</span>, p)))</span><br><span class="line"></span><br><span class="line">M = Matrix(QQ, <span class="number">40</span>, <span class="number">40</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">38</span>):</span><br><span class="line">    M[i, i] = p</span><br><span class="line">    M[<span class="number">38</span>, i] = A[i]</span><br><span class="line">    M[<span class="number">39</span>, i] = B[i]</span><br><span class="line">M[<span class="number">38</span>, <span class="number">38</span>] = (<span class="number">2</span> ^ <span class="number">496</span>)/p</span><br><span class="line">M[<span class="number">39</span>, <span class="number">39</span>] = <span class="number">2</span> ^ <span class="number">496</span></span><br><span class="line">res = M.LLL()</span><br><span class="line"><span class="built_in">print</span>(res[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>
<h1 id="SICTF-Round2"><a href="#SICTF-Round2" class="headerlink" title="SICTF Round2"></a>SICTF Round2</h1><p>å¤§éƒ¨åˆ†éƒ½æ˜¯éšæ‰‹å‡ºçš„é¢˜å°±ä¸å¾€ä¸Šæ”¾äº†ã€‚</p>
<h2 id="ç­¾åˆ°é¢˜æ¥å’¯ï¼ï¼ˆèµ›åï¼‰"><a href="#ç­¾åˆ°é¢˜æ¥å’¯ï¼ï¼ˆèµ›åï¼‰" class="headerlink" title="ç­¾åˆ°é¢˜æ¥å’¯ï¼ï¼ˆèµ›åï¼‰"></a>ç­¾åˆ°é¢˜æ¥å’¯ï¼ï¼ˆèµ›åï¼‰</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span>  Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">e = getPrime(<span class="number">10</span>)</span><br><span class="line">n = p*q</span><br><span class="line">c1 = <span class="built_in">pow</span>(<span class="number">114</span>*m+<span class="number">2333</span>,e,n)</span><br><span class="line">c2 = <span class="built_in">pow</span>(<span class="number">514</span>*m+<span class="number">4555</span>,e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;n = <span class="subst">&#123;n&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c1 = <span class="subst">&#123;c1&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;c2 = <span class="subst">&#123;c2&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 18993579800590288733556762316465854395650778003397512624355925069287661487515652428099677335464809283955351330659278915073219733930542167360381688856732762552737791137784222098296804826261681852699742456526979985201331982720936091963830799430264680941164508709453794113576607749669278887105809727027129736803614327631979056934906547015919204770702496676692691248702461766117271815398943842909579917102217310779431999448597899109808086655029624478062317317442297276087073653945439820988375066353157221370129064423613949039895822016206336117081475698987326594199181180346821431242733826487765566154350269651592993856883</span></span><br><span class="line"><span class="string">c1 = 3089900890429368903963127778258893993015616003863275300568951378177309984878857933740319974151823410060583527905656182419531008417050246901514691111335764182779077027419410717272164998075313101695833565450587029584857433998627248705518025411896438130004108810308599666206694770859843696952378804678690327442746359836105117371144846629293505396610982407985241783168161504309420302314102538231774470927864959064261347913286659384383565379900391857812482728653358741387072374314243068833590379370244368317200796927931678203916569721211768082289529948017340699194622234734381555103898784827642197721866114583358940604520</span></span><br><span class="line"><span class="string">c2 = 6062491672599671503583327431533992487890060173533816222838721749216161789662841049274959778509684968479022417053571624473283543736981267659104310293237792925201009775193492423025040929132360886500863823523629213703533794348606076463773478200331006341206053010168741302440409050344170767489936681627020501853981450212305108039373119567034948781143698613084550376070802084805644270376620484786155554275798939105737707005991882264123315436368611647275530607811665999620394422672764116158492214128572456571553281799359243174598812137554860109807481900330449364878168308833006964726761878461761560543284533578701661413931</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>æ²¡çœ‹å‡ºæ¥æ˜¯Franklin Reiteræ”»å‡»ï¼Œè¿™æ¬¡åšé¢˜åˆæŠŠè¿™ä¸ªæ”»å‡»æ–¹å¼å›é¡¾äº†ä¸€éï¼š</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> trange</span><br><span class="line"></span><br><span class="line">n = <span class="number">18993579800590288733556762316465854395650778003397512624355925069287661487515652428099677335464809283955351330659278915073219733930542167360381688856732762552737791137784222098296804826261681852699742456526979985201331982720936091963830799430264680941164508709453794113576607749669278887105809727027129736803614327631979056934906547015919204770702496676692691248702461766117271815398943842909579917102217310779431999448597899109808086655029624478062317317442297276087073653945439820988375066353157221370129064423613949039895822016206336117081475698987326594199181180346821431242733826487765566154350269651592993856883</span></span><br><span class="line">c1 = <span class="number">3089900890429368903963127778258893993015616003863275300568951378177309984878857933740319974151823410060583527905656182419531008417050246901514691111335764182779077027419410717272164998075313101695833565450587029584857433998627248705518025411896438130004108810308599666206694770859843696952378804678690327442746359836105117371144846629293505396610982407985241783168161504309420302314102538231774470927864959064261347913286659384383565379900391857812482728653358741387072374314243068833590379370244368317200796927931678203916569721211768082289529948017340699194622234734381555103898784827642197721866114583358940604520</span></span><br><span class="line">c2 = <span class="number">6062491672599671503583327431533992487890060173533816222838721749216161789662841049274959778509684968479022417053571624473283543736981267659104310293237792925201009775193492423025040929132360886500863823523629213703533794348606076463773478200331006341206053010168741302440409050344170767489936681627020501853981450212305108039373119567034948781143698613084550376070802084805644270376620484786155554275798939105737707005991882264123315436368611647275530607811665999620394422672764116158492214128572456571553281799359243174598812137554860109807481900330449364878168308833006964726761878461761560543284533578701661413931</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GCD</span>(<span class="params">a,b</span>):</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> a.monic()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> GCD(b,a % b)</span><br><span class="line">    </span><br><span class="line">P.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> e <span class="keyword">in</span> trange(<span class="number">2</span>**<span class="number">10</span>):</span><br><span class="line">    <span class="keyword">if</span> isPrime(e):</span><br><span class="line">        i=e</span><br><span class="line">        f1 = (<span class="number">114</span>*x+<span class="number">2333</span>) ^ i - c1</span><br><span class="line">        f2 = (<span class="number">514</span>*x+<span class="number">4555</span>) ^ i - c2</span><br><span class="line">        <span class="keyword">if</span> GCD(f1,f2)[<span class="number">0</span>] != <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(n - GCD(f1,f2)[<span class="number">0</span>])))</span><br></pre></td></tr></table></figure>
<h1 id="SHCTF"><a href="#SHCTF" class="headerlink" title="SHCTF"></a>SHCTF</h1><p>é¢˜ç›®æ•´ä½“æ¯”è¾ƒç®€å•ï¼Œè¯¥çœçš„çœäº†ã€‚</p>
<h2 id="XOR"><a href="#XOR" class="headerlink" title="XOR"></a>XOR</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">20810298530643139779725379335557687960281905096107101411585220918672653323875234344540342801651123667553812866458790076971583539529404583369246005781146655852295475940942005806084842620601383912513102861245275690036363402134681262533947475193408594967684453091957401932685922178406769578067946779033282889429596341714417295489842047781388337010440309434639274398589029236213499110100040841426995862849012466514170374143655264739023758914247116354182164550612494432327931655944868705959874670536031052370968354394583880324756639698871918124498442308334232127034553164826483441746719644515097123067550594588348951855987</span></span><br><span class="line">c = <span class="number">15294238831055894095745317706739204020319929545635634316996804750424242996533741450795483290384329104330090410419090776738963732127756947425265305276394058773237118310164375814515488333015347737716139073947021972607133348357843542310589577847859875065651579863803460777883480006078771792286205582765870786584904810922437581419555823588531402681156158991972023042592179567351862630979979989132957073962160946903567157184627177910380657091234027709595863061642453096671316307805667922247180282486325569430449985678954185611299166777141304330040782500340791721548519463552822293017606441987565074653579432972931432057376</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">pâŠ•q = <span class="number">66138689143868607947630785415331461127626263390302506173955100963855136134289233949354345883327245336547595357625259526618623795152771487180400409991587378085305813144661971099363267511657121911410275002816755637490837422852032755234403225128695875574749525003296342076268760708900752562579555935703659615570</span></span><br></pre></td></tr></table></figure>
<p>ç»™äº†$p\oplus q$ï¼Œç½‘ä¸Šéšä¾¿æ‰¾äº†ä¸ªåˆ†è§£è„šæœ¬æ¢­å“ˆäº†ï¼š</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_cong</span>(<span class="params">k, p, q, n, xored=<span class="literal">None</span></span>):</span><br><span class="line">    kmask = (<span class="number">1</span> &lt;&lt; k) - <span class="number">1</span></span><br><span class="line">    p &amp;= kmask</span><br><span class="line">    q &amp;= kmask</span><br><span class="line">    n &amp;= kmask</span><br><span class="line">    pqm = (p*q) &amp; kmask</span><br><span class="line">    <span class="keyword">return</span> pqm == n <span class="keyword">and</span> (xored <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> (p^q) == (xored &amp; kmask))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extend</span>(<span class="params">k, a</span>):</span><br><span class="line">    kbit = <span class="number">1</span> &lt;&lt; (k-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">assert</span> a &lt; kbit</span><br><span class="line">    <span class="keyword">yield</span> a</span><br><span class="line">    <span class="keyword">yield</span> a | kbit</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">factor</span>(<span class="params">n, p_xor_q</span>):</span><br><span class="line">    tracked = <span class="built_in">set</span>([(p, q) <span class="keyword">for</span> p <span class="keyword">in</span> [<span class="number">0</span>, <span class="number">1</span>] <span class="keyword">for</span> q <span class="keyword">in</span> [<span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">                   <span class="keyword">if</span> check_cong(<span class="number">1</span>, p, q, n, p_xor_q)])</span><br><span class="line"></span><br><span class="line">    PRIME_BITS = <span class="built_in">int</span>(math.ceil(math.log(n, <span class="number">2</span>)/<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">    maxtracked = <span class="built_in">len</span>(tracked)</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, PRIME_BITS+<span class="number">1</span>):</span><br><span class="line">        newset = <span class="built_in">set</span>()</span><br><span class="line">        <span class="keyword">for</span> tp, tq <span class="keyword">in</span> tracked:</span><br><span class="line">            <span class="keyword">for</span> newp_ <span class="keyword">in</span> extend(k, tp):</span><br><span class="line">                <span class="keyword">for</span> newq_ <span class="keyword">in</span> extend(k, tq):</span><br><span class="line">                    <span class="comment"># Remove symmetry</span></span><br><span class="line">                    newp, newq = <span class="built_in">sorted</span>([newp_, newq_])</span><br><span class="line">                    <span class="keyword">if</span> check_cong(k, newp, newq, n, p_xor_q):</span><br><span class="line">                        newset.add((newp, newq))</span><br><span class="line"></span><br><span class="line">        tracked = newset</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(tracked) &gt; maxtracked:</span><br><span class="line">            maxtracked = <span class="built_in">len</span>(tracked)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Tracked set size: &#123;&#125; (max=&#123;&#125;)&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(tracked), maxtracked))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># go through the tracked set and pick the correct (p, q)</span></span><br><span class="line">    <span class="keyword">for</span> p, q <span class="keyword">in</span> tracked:</span><br><span class="line">        <span class="keyword">if</span> p != <span class="number">1</span> <span class="keyword">and</span> p*q == n:</span><br><span class="line">            <span class="keyword">return</span> p, q</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> <span class="literal">False</span>, <span class="string">&#x27;factors were not in tracked set. Is your p^q correct?&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="number">20810298530643139779725379335557687960281905096107101411585220918672653323875234344540342801651123667553812866458790076971583539529404583369246005781146655852295475940942005806084842620601383912513102861245275690036363402134681262533947475193408594967684453091957401932685922178406769578067946779033282889429596341714417295489842047781388337010440309434639274398589029236213499110100040841426995862849012466514170374143655264739023758914247116354182164550612494432327931655944868705959874670536031052370968354394583880324756639698871918124498442308334232127034553164826483441746719644515097123067550594588348951855987</span></span><br><span class="line">p_xor_q = <span class="number">66138689143868607947630785415331461127626263390302506173955100963855136134289233949354345883327245336547595357625259526618623795152771487180400409991587378085305813144661971099363267511657121911410275002816755637490837422852032755234403225128695875574749525003296342076268760708900752562579555935703659615570</span></span><br><span class="line">c = <span class="number">15294238831055894095745317706739204020319929545635634316996804750424242996533741450795483290384329104330090410419090776738963732127756947425265305276394058773237118310164375814515488333015347737716139073947021972607133348357843542310589577847859875065651579863803460777883480006078771792286205582765870786584904810922437581419555823588531402681156158991972023042592179567351862630979979989132957073962160946903567157184627177910380657091234027709595863061642453096671316307805667922247180282486325569430449985678954185611299166777141304330040782500340791721548519463552822293017606441987565074653579432972931432057376</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">p, q = factor(n, p_xor_q)</span><br><span class="line">phi=(p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d=gmpy2.invert(e,phi)</span><br><span class="line">m=<span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br></pre></td></tr></table></figure>
<h2 id="easymath"><a href="#easymath" class="headerlink" title="easymath"></a>easymath</h2><p>LCGæ¿å­é¢˜ï¼Œå¤ªç®€å•äº†ä¸çœ‹äº†ã€‚</p>
<h2 id="ez-rsa"><a href="#ez-rsa" class="headerlink" title="ez_rsa"></a>ez_rsa</h2><p>flagåˆ†äº†ä¸¤åŠï¼Œä¸€åŠyafuä¸€åŠå…±æ¨¡ã€‚</p>
<h2 id="eï¼Ÿ"><a href="#eï¼Ÿ" class="headerlink" title="eï¼Ÿ"></a>eï¼Ÿ</h2><p>ä¸äº’ç´ ã€‚</p>
<h2 id="factorizing-n"><a href="#factorizing-n" class="headerlink" title="factorizing_n"></a>factorizing_n</h2><p>yafuã€‚</p>
<h1 id="N1CTF"><a href="#N1CTF" class="headerlink" title="N1CTF"></a>N1CTF</h1><h2 id="e2W-rmup"><a href="#e2W-rmup" class="headerlink" title="e2W@rmup"></a>e2W@rmup</h2></article><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="ä½¿ç”¨æ‰‹æœºè®¿é—®è¿™ç¯‡æ–‡ç« "><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2023/07/06/%E8%BF%91%E6%9C%9F%E6%AF%94%E8%B5%9B%E5%A4%8D%E7%8E%B0Vol.1/"></div><div class="reward-dec">ä½¿ç”¨æ‰‹æœºè®¿é—®è¿™ç¯‡æ–‡ç« </div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=undefined&amp;url=http://example.com/2023/07/06/%E8%BF%91%E6%9C%9F%E6%AF%94%E8%B5%9B%E5%A4%8D%E7%8E%B0Vol.1/&amp;pic=undefined" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="å¤åˆ¶é“¾æ¥" onclick="rm.copyPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/ECC/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>ECC<span class="tagsPageCount">7</span></a><a class="post-meta__box__tags" href="/tags/RSA/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>RSA<span class="tagsPageCount">25</span></a><a class="post-meta__box__tags" href="/tags/%E6%B5%81%E5%AF%86%E7%A0%81/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>æµå¯†ç <span class="tagsPageCount">7</span></a></div></div></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/06/21/%E5%91%A8%E5%88%86%E4%BA%AB2%EF%BC%9A%E8%83%8C%E5%8C%85%E5%AF%86%E7%A0%81%E4%BD%93%E5%88%B6/"><img class="prev-cover" src="https://s2.loli.net/2023/06/21/N8Redfn3r2Jascp.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">å‘¨åˆ†äº«2ï¼šèƒŒåŒ…å¯†ç ä½“åˆ¶</div></div></a></div><div class="next-post pull-right"><a href="/2023/07/23/Reverse%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89/"><img class="next-cover" src="https://s2.loli.net/2023/07/23/i8Fufwdo7xbVks3.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">Reverseå­¦ä¹ æ—¥è®°ï¼ˆäºŒï¼‰</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/2024/02/03/%E8%BF%91%E6%9C%9F%E6%AF%94%E8%B5%9B%E5%A4%8D%E7%8E%B0Vol-3/" title="è¿‘æœŸæ¯”èµ›å¤ç°Vol.3"><img class="cover" src="https://s2.loli.net/2024/02/03/ZgYIKVNU3vxyzMt.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-02-03</div><div class="title">è¿‘æœŸæ¯”èµ›å¤ç°Vol.3</div></div></a></div><div><a href="/2023/05/14/LitCTF%E5%A4%8D%E7%8E%B0/" title="LitCTFå¤ç°"><img class="cover" src="https://s2.loli.net/2023/05/14/CtirxsS8YE7qhFA.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-05-14</div><div class="title">LitCTFå¤ç°</div></div></a></div><div><a href="/2024/04/12/%E8%BF%91%E6%9C%9F%E6%AF%94%E8%B5%9B%E5%A4%8D%E7%8E%B0Vol-4/" title="è¿‘æœŸæ¯”èµ›å¤ç°Vol.4"><img class="cover" src="https://s2.loli.net/2024/02/03/ZgYIKVNU3vxyzMt.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-04-12</div><div class="title">è¿‘æœŸæ¯”èµ›å¤ç°Vol.4</div></div></a></div><div><a href="/2023/05/28/CISCN2023%E5%A4%8D%E7%8E%B0/" title="CISCN2023å¤ç°"><img class="cover" src="https://s2.loli.net/2023/05/28/UAELr2yp7GRbdOM.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-05-28</div><div class="title">CISCN2023å¤ç°</div></div></a></div><div><a href="/2023/01/04/CryptoHack%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%953/" title="CryptoHackå­¦ä¹ è®°å½•ï¼ˆä¸‰ï¼‰"><img class="cover" src="https://s2.loli.net/2023/01/04/h6xEvisrJjBQdm3.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-01-04</div><div class="title">CryptoHackå­¦ä¹ è®°å½•ï¼ˆä¸‰ï¼‰</div></div></a></div><div><a href="/2023/04/05/ECC%E6%A4%AD%E5%9C%86%E6%9B%B2%E7%BA%BF%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/" title="ECCæ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•"><img class="cover" src="https://s2.loli.net/2023/04/08/YlLKU91u6BnaObs.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2023-04-05</div><div class="title">ECCæ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> è¯„è®º</span></div><div class="comment-randomInfo" style="display: none"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">åŒ¿åè¯„è®º</a></div><div class="comment-tips" id="comment-tips"><span>ä½ æ— éœ€åˆ é™¤ç©ºè¡Œï¼Œç›´æ¥è¯„è®ºä»¥è·å–æœ€ä½³å±•ç¤ºæ•ˆæœ</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div><div class="comment-barrage"></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SCTF"><span class="toc-text">SCTF</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Barter%EF%BC%88%E8%B5%9B%E5%90%8E%EF%BC%89"><span class="toc-text">Barterï¼ˆèµ›åï¼‰</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GoogleCTF"><span class="toc-text">GoogleCTF</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#LCG%EF%BC%88%E8%B5%9B%E5%90%8E%EF%BC%89"><span class="toc-text">LCGï¼ˆèµ›åï¼‰</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A22023"><span class="toc-text">å·…å³°æå®¢2023</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E5%AD%A6%E4%BD%86%E9%AB%98%E4%B8%AD"><span class="toc-text">æ•°å­¦ä½†é«˜ä¸­</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Simple-encryption"><span class="toc-text">Simple_encryption</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DASCTF-2023%E4%B8%83%E6%9C%88"><span class="toc-text">DASCTF 2023ä¸ƒæœˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ezDHKE"><span class="toc-text">ezDHKE</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ezRSA%EF%BC%88%E8%B5%9B%E5%90%8E%EF%BC%89"><span class="toc-text">ezRSAï¼ˆèµ›åï¼‰</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NepCTF-2023"><span class="toc-text">NepCTF 2023</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#random-RSA%EF%BC%88%E8%B5%9B%E5%90%8E%EF%BC%89"><span class="toc-text">random_RSAï¼ˆèµ›åï¼‰</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WMCTF"><span class="toc-text">WMCTF</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#signin"><span class="toc-text">signin</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SICTF-Round2"><span class="toc-text">SICTF Round2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AD%BE%E5%88%B0%E9%A2%98%E6%9D%A5%E5%92%AF%EF%BC%81%EF%BC%88%E8%B5%9B%E5%90%8E%EF%BC%89"><span class="toc-text">ç­¾åˆ°é¢˜æ¥å’¯ï¼ï¼ˆèµ›åï¼‰</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SHCTF"><span class="toc-text">SHCTF</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#XOR"><span class="toc-text">XOR</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#easymath"><span class="toc-text">easymath</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ez-rsa"><span class="toc-text">ez_rsa</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#e%EF%BC%9F"><span class="toc-text">eï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#factorizing-n"><span class="toc-text">factorizing_n</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#N1CTF"><span class="toc-text">N1CTF</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#e2W-rmup"><span class="toc-text">e2W@rmup</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2024 By Chemtrails</div></div></footer><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" src="https://ch3mtr4ils.cn/img/tit.png"/><div class="loading-image-dot"></div><div id="loading-percentage">0%</div></div></div><script>const loadingPercentage = document.getElementById("loading-percentage");
let loadingPercentageTimer = setInterval(function() {
  var progressBar = document.querySelector(".pace-progress");
  if (!progressBar) return
  var currentValue = progressBar.getAttribute("data-progress-text");
  if (currentValue !== loadingPercentage.textContent) {
    loadingPercentage.textContent = currentValue;
    if (currentValue === "100%") {
      clearInterval(loadingPercentageTimer);
    }
  }
}, 100);
const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/progress_bar/progress_bar.css"/><script async="async" src="https://npm.elemecdn.com/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://ch3mtr4ils.cn/img/tit.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">æ–‡ç« </div><div class="length-num">82</div></a><a href="/tags/" title="tag"><div class="headline">æ ‡ç­¾</div><div class="length-num">39</div></a><a href="/categories/" title="category"><div class="headline">åˆ†ç±»</div><div class="length-num">6</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><span> æ–‡ç« </span></a><ul class="menus_item_child" style="left:-79px;"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> å½’æ¡£</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> åˆ†ç±»</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> æ ‡ç­¾</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><span> å‹é“¾</span></a><ul class="menus_item_child" style="left:17px;"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> å‹äººå¸</span></a></li></ul></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="javascript:void(0);"><span> å…³äº</span></a><ul class="menus_item_child" style="left:-31px;"><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> é—²è¨€ç¢è¯­</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> éšä¾¿é€›é€›</span></a></li></ul></div></div></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç¹</button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a id="switch_commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" title="å¼€å…³å¼¹å¹•"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="center-console" type="button" title="ä¸­æ§å°"><i class="anzhiyufont anzhiyu-icon-fish"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><div id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()">æ’­æ”¾éŸ³ä¹</div><div id="console-music-bg"></div><meting-js id="2987103132" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="console"><div class="close-btn" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-xmark" style="font-size: 35px;"></i></div><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="wechat" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="alipay" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments" onclick="anzhiyu.hideConsole()"><div class="card-content"><div class="author-content-item-tips">äº’åŠ¨</div><span class="author-content-item-title"> <span>æœ€æ–°è¯„è®º</span></span></div><div class="aside-list"><span>æ­£åœ¨åŠ è½½ä¸­...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags" onclick="anzhiyu.hideConsole()"><div class="card-content"><div class="author-content-item-tips">å…´è¶£ç‚¹</div><span class="author-content-item-title">å¯»æ‰¾ä½ æ„Ÿå…´è¶£çš„é¢†åŸŸ</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/AES/" style="font-size: 1.22em; color: rgb(79, 121, 185)">AES<sup>3</sup></a><a href="/tags/DES/" style="font-size: 1.15em; color: rgb(58, 17, 153)">DES<sup>1</sup></a><a href="/tags/Diffie-Hellman/" style="font-size: 1.15em; color: rgb(68, 194, 152)">Diffie-Hellman<sup>1</sup></a><a href="/tags/ECC/" style="font-size: 1.38em; color: rgb(2, 95, 162)">ECC<sup>7</sup></a><a href="/tags/ElGamal/" style="font-size: 1.15em; color: rgb(43, 30, 53)">ElGamal<sup>1</sup></a><a href="/tags/HTML/" style="font-size: 1.15em; color: rgb(195, 15, 74)">HTML<sup>1</sup></a><a href="/tags/Isogeny/" style="font-size: 1.15em; color: rgb(155, 34, 79)">Isogeny<sup>1</sup></a><a href="/tags/JS/" style="font-size: 1.15em; color: rgb(162, 28, 41)">JS<sup>1</sup></a><a href="/tags/JWT/" style="font-size: 1.15em; color: rgb(46, 59, 118)">JWT<sup>1</sup></a><a href="/tags/Java/" style="font-size: 1.19em; color: rgb(65, 95, 164)">Java<sup>2</sup></a><a href="/tags/RCE/" style="font-size: 1.15em; color: rgb(15, 156, 5)">RCE<sup>1</sup></a><a href="/tags/RSA/" style="font-size: 1.45em; color: rgb(69, 20, 11)">RSA<sup>25</sup></a><a href="/tags/SQL/" style="font-size: 1.15em; color: rgb(31, 166, 113)">SQL<sup>1</sup></a><a href="/tags/css/" style="font-size: 1.19em; color: rgb(13, 60, 74)">css<sup>2</sup></a><a href="/tags/git/" style="font-size: 1.15em; color: rgb(142, 77, 177)">git<sup>1</sup></a><a href="/tags/linux/" style="font-size: 1.15em; color: rgb(182, 152, 175)">linux<sup>1</sup></a><a href="/tags/paper/" style="font-size: 1.15em; color: rgb(103, 63, 3)">paper<sup>1</sup></a><a href="/tags/php/" style="font-size: 1.22em; color: rgb(11, 166, 94)">php<sup>3</sup></a><a href="/tags/python/" style="font-size: 1.3em; color: rgb(36, 96, 146)">python<sup>5</sup></a><a href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/" style="font-size: 1.19em; color: rgb(46, 98, 14)">åŒºå—é“¾<sup>2</sup></a><a href="/tags/%E5%8F%A4%E5%85%B8%E5%AF%86%E7%A0%81/" style="font-size: 1.3em; color: rgb(198, 178, 39)">å¤å…¸å¯†ç <sup>5</sup></a><a href="/tags/%E5%8F%AF%E4%BF%A1%E8%AE%A1%E7%AE%97/" style="font-size: 1.15em; color: rgb(115, 165, 55)">å¯ä¿¡è®¡ç®—<sup>1</sup></a><a href="/tags/%E5%93%88%E5%B8%8C%E5%87%BD%E6%95%B0/" style="font-size: 1.15em; color: rgb(62, 127, 115)">å“ˆå¸Œå‡½æ•°<sup>1</sup></a><a href="/tags/%E5%9B%BE%E7%89%87%E5%88%86%E6%9E%90/" style="font-size: 1.3em; color: rgb(76, 191, 161)">å›¾ç‰‡åˆ†æ<sup>5</sup></a><a href="/tags/%E5%9B%BE%E7%89%87%E9%9A%90%E5%86%99/" style="font-size: 1.3em; color: rgb(191, 89, 33)">å›¾ç‰‡éšå†™<sup>5</sup></a><a href="/tags/%E5%A4%9A%E9%A1%B9%E5%BC%8F/" style="font-size: 1.22em; color: rgb(47, 62, 160)">å¤šé¡¹å¼<sup>3</sup></a><a href="/tags/%E6%8A%BD%E8%B1%A1%E4%BB%A3%E6%95%B0/" style="font-size: 1.3em; color: rgb(151, 0, 12)">æŠ½è±¡ä»£æ•°<sup>5</sup></a><a href="/tags/%E6%95%B0%E8%AE%BA/" style="font-size: 1.3em; color: rgb(159, 161, 199)">æ•°è®º<sup>5</sup></a><a href="/tags/%E6%A0%88%E6%BA%A2%E5%87%BA/" style="font-size: 1.15em; color: rgb(38, 169, 125)">æ ˆæº¢å‡º<sup>1</sup></a><a href="/tags/%E6%A0%BC/" style="font-size: 1.41em; color: rgb(66, 181, 54)">æ ¼<sup>8</sup></a><a href="/tags/%E6%B1%87%E7%BC%96/" style="font-size: 1.19em; color: rgb(161, 185, 110)">æ±‡ç¼–<sup>2</sup></a><a href="/tags/%E6%B5%81%E5%AF%86%E7%A0%81/" style="font-size: 1.38em; color: rgb(26, 75, 143)">æµå¯†ç <sup>7</sup></a><a href="/tags/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/" style="font-size: 1.19em; color: rgb(64, 50, 92)">æµé‡åˆ†æ<sup>2</sup></a><a href="/tags/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/" style="font-size: 1.19em; color: rgb(52, 158, 83)">çº¿æ€§ä»£æ•°<sup>2</sup></a><a href="/tags/%E7%BC%96%E7%A0%81/" style="font-size: 1.34em; color: rgb(161, 165, 110)">ç¼–ç <sup>6</sup></a><a href="/tags/%E8%83%8C%E5%8C%85%E5%AF%86%E7%A0%81/" style="font-size: 1.15em; color: rgb(35, 49, 133)">èƒŒåŒ…å¯†ç <sup>1</sup></a><a href="/tags/%E9%80%86%E5%90%91/" style="font-size: 1.22em; color: rgb(68, 168, 41)">é€†å‘<sup>3</sup></a><a href="/tags/%E9%87%8F%E5%AD%90%E8%AE%A1%E7%AE%97/" style="font-size: 1.19em; color: rgb(177, 176, 128)">é‡å­è®¡ç®—<sup>2</sup></a><a href="/tags/%E9%9A%8F%E6%9C%BA%E6%95%B0/" style="font-size: 1.26em; color: rgb(124, 173, 26)">éšæœºæ•°<sup>4</sup></a></div></div><hr/></div></div><div class="console-card history" onclick="anzhiyu.hideConsole()"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>æ–‡ç« </span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>å½’æ¡£</span><a class="card-more-btn" href="/archives/" title="æŸ¥çœ‹æ›´å¤š">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">å…«æœˆ 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">ä¸ƒæœˆ 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">å››æœˆ 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">ä¸‰æœˆ 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/02/"><span class="card-archive-list-date">äºŒæœˆ 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">ä¸€æœˆ 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">åä¸€æœˆ 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>ç¯‡</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">åæœˆ 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>ç¯‡</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" onclick="rm.switchDarkMode()" title="æ˜¾ç¤ºæ¨¡å¼åˆ‡æ¢" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="è¾¹æ æ˜¾ç¤ºæ§åˆ¶"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="çƒ­è¯„å¼€å…³"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="éŸ³ä¹å¼€å…³"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>å¤åˆ¶é€‰ä¸­æ–‡æœ¬</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>ç²˜è´´æ–‡æœ¬</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>å¼•ç”¨åˆ°è¯„è®º</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>æ–°çª—å£æ‰“å¼€</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>å¤åˆ¶é“¾æ¥åœ°å€</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>å¤åˆ¶æ­¤å›¾ç‰‡</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>ä¸‹è½½æ­¤å›¾ç‰‡</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>æ–°çª—å£æ‰“å¼€å›¾ç‰‡</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>ç«™å†…æœç´¢</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>ç™¾åº¦æœç´¢</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>æ’­æ”¾éŸ³ä¹</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>åˆ‡æ¢åˆ°ä¸Šä¸€é¦–</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>åˆ‡æ¢åˆ°ä¸‹ä¸€é¦–</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://music.163.com/#/my/m/music/playlist?id=2987103132&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>æŸ¥çœ‹æ‰€æœ‰æ­Œæ›²</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>å¤åˆ¶æ­Œå</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>éšä¾¿é€›é€›</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>åšå®¢åˆ†ç±»</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>æ–‡ç« æ ‡ç­¾</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>å¤åˆ¶åœ°å€</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">å…³é—­çƒ­è¯„</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">æ·±è‰²æ¨¡å¼</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>è½‰ç‚ºç¹é«”</span></a></div></div><div id="rightmenu-mask"></div><div><script src="https://npm.elemecdn.com/hexo-theme-anzhiyu@1.1.7/source/js/utils.js"></script><script src="https://npm.elemecdn.com/hexo-theme-anzhiyu@1.1.7/source/js/main.js"></script><script src="https://npm.elemecdn.com/hexo-theme-anzhiyu@1.1.7/source/js/tw_cn.js"></script><script src="https://npm.elemecdn.com/@fancyapps/ui@4.0.31/dist/fancybox.umd.js"></script><script src="https://npm.elemecdn.com/instant.page@5.1.1/instantpage.js" type="module"></script><script src="https://npm.elemecdn.com/vanilla-lazyload@17.3.1/dist/lazyload.iife.min.js"></script><script src="https://npm.elemecdn.com/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// æ¶ˆé™¤æ§åˆ¶å°æ‰“å°
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  console.log(1)
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //åœ¨æ¢å¤å‰è¾“å‡ºæ—¥å¿—
  const grt = new Date("11/4/2022 00:00:00"); //æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `æ­£åœ¨çœ‹ç½‘ç«™çš„ä½ !`,
    `æˆ‘çš„ç½‘ç«™`,
    "å·²ä¸Šçº¿",
    dnum,
    "å¤©",
    "Â©2022 By Chemtrails",
  ];
  const ascll2 = [`HELLO`, `è°ƒç”¨å‰ç½®æ‘„åƒå¤´æ‹ç…§æˆåŠŸï¼Œè¯†åˆ«ä¸ºã€å°ç¬¨è›‹ã€‘.`, `ç…§ç‰‡æ•è·: `, `ğŸ¤ª`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#3b70fc",
      "",
      "color:#3b70fc",
      "color:#3b70fc",
      "",
      "color:#3b70fc",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c ä½ å¥½ï¼Œå°ç¬¨è›‹ï¼Œä½ å·²æ‰“å¼€æ§åˆ¶å°ã€‚", "color:white; background-color:#4f90d9", ""));
  setTimeout(Log.bind(console, "%c âš¡ Powered by Chemtrails %c ä½ æ­£åœ¨è®¿é—® Chemtrails çš„åšå®¢ã€‚", "color:white; background-color:#f0ad4e", ""));

});</script><script async src="/anzhiyu/random.js"></script><script src="https://npm.elemecdn.com/hexo-theme-anzhiyu@1.1.7/source/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://npm.elemecdn.com/mathjax@3.2.2/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.ch3mtr4ils.cn/',
      region: '',
      onCommentLoaded: function () {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.ch3mtr4ils.cn/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://npm.elemecdn.com/twikoo@1.6.11/dist/twikoo.all.min.js').then(runFn)
  }
  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[å›¾ç‰‡]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[é“¾æ¥]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[ä»£ç ]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.ch3mtr4ils.cn/',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.innerHTML= "æ— æ³•è·å–è¯„è®ºï¼Œè¯·ç¡®è®¤ç›¸å…³é…ç½®æ˜¯å¦æ­£ç¡®"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://npm.elemecdn.com/twikoo@1.6.11/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick}</span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += 'æ²¡æœ‰è¯„è®º'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/catalog-bar/catalog-bar.js"></script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/categoryBar/categoryBar.js"></script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script>// åˆå§‹åŒ–å‡½æ•°
let rm = {};

//ç¦æ­¢å›¾ç‰‡æ‹–æ‹½
let imgElements = document.getElementsByTagName("img");
for (let i = 0; i < imgElements.length; i++) {
  imgElements[i].addEventListener("dragstart", function (event) {
    event.preventDefault();
  });
}

// æ˜¾ç¤ºèœå•
rm.showRightMenu = function (isTrue, x = 0, y = 0) {
  console.info(x, y)
  let rightMenu = document.getElementById("rightMenu");
  rightMenu.style.top = x + "px";
  rightMenu.style.left = y + "px";
  if (isTrue) {
    rightMenu.style.display = "block";
    stopMaskScroll();
  } else {
    rightMenu.style.display = "none";
  }
};

// éšè—èœå•
rm.hideRightMenu = function () {
  rm.showRightMenu(false);
  let rightMenuMask = document.querySelector("#rightmenu-mask");
  rightMenuMask.style.display = "none";
};

// å°ºå¯¸
let rmWidth = document.getElementById("rightMenu").offsetWidth;
let rmHeight = document.getElementById("rightMenu").offsetHeight;

// é‡æ–°å®šä¹‰å°ºå¯¸
rm.reloadrmSize = function () {
  rightMenu.style.visibility = "hidden";
  rightMenu.style.display = "block";
  // è·å–å®½åº¦å’Œé«˜åº¦
  rmWidth = document.getElementById("rightMenu").offsetWidth;
  rmHeight = document.getElementById("rightMenu").offsetHeight;
  rightMenu.style.visibility = "visible";
};

// è·å–ç‚¹å‡»çš„href
let domhref = "";
let domImgSrc = "";
let globalEvent = null;

// ç›‘å¬å³é”®åˆå§‹åŒ–
window.oncontextmenu = function (event) {
  if (document.body.clientWidth > 768) {
    let pageX = event.clientX + 10; //åŠ 10æ˜¯ä¸ºäº†é˜²æ­¢æ˜¾ç¤ºæ—¶é¼ æ ‡é®åœ¨èœå•ä¸Š
    let pageY = event.clientY;

    //å…¶ä»–é¢å¤–èœå•
    const $rightMenuOther = document.querySelector(".rightMenuOther");
    const $rightMenuPlugin = document.querySelector(".rightMenuPlugin");
    const $rightMenuCopyText = document.querySelector("#menu-copytext");
    const $rightMenuPasteText = document.querySelector("#menu-pastetext");
    const $rightMenuCommentText = document.querySelector("#menu-commenttext");
    const $rightMenuNewWindow = document.querySelector("#menu-newwindow");
    const $rightMenuNewWindowImg = document.querySelector("#menu-newwindowimg");
    const $rightMenuCopyLink = document.querySelector("#menu-copylink");
    const $rightMenuCopyImg = document.querySelector("#menu-copyimg");
    const $rightMenuDownloadImg = document.querySelector("#menu-downloadimg");
    const $rightMenuSearch = document.querySelector("#menu-search");
    const $rightMenuSearchBaidu = document.querySelector("#menu-searchBaidu");
    const $rightMenuMusicToggle = document.querySelector("#menu-music-toggle");
    const $rightMenuMusicBack = document.querySelector("#menu-music-back");
    const $rightMenuMusicForward = document.querySelector("#menu-music-forward");
    const $rightMenuMusicPlaylist = document.querySelector("#menu-music-playlist");
    const $rightMenuMusicCopyMusicName = document.querySelector("#menu-music-copyMusicName");

    let href = event.target.href;
    let imgsrc = event.target.currentSrc;

    // åˆ¤æ–­æ¨¡å¼ æ‰©å±•æ¨¡å¼ä¸ºæœ‰äº‹ä»¶
    let pluginMode = false;
    $rightMenuOther.style.display = "block";
    globalEvent = event;

    // æ£€æŸ¥æ˜¯å¦éœ€è¦å¤åˆ¶ æ˜¯å¦æœ‰é€‰ä¸­æ–‡æœ¬
    if (selectTextNow && window.getSelection()) {
      pluginMode = true;
      $rightMenuCopyText.style.display = "block";
      $rightMenuCommentText.style.display = "block";
      $rightMenuSearch.style.display = "block";
      $rightMenuSearchBaidu.style.display = "block";
    } else {
      $rightMenuCopyText.style.display = "none";
      $rightMenuCommentText.style.display = "none";
      $rightMenuSearchBaidu.style.display = "none";
      $rightMenuSearch.style.display = "none";
    }

    //æ£€æŸ¥æ˜¯å¦å³é”®ç‚¹å‡»äº†é“¾æ¥aæ ‡ç­¾
    if (href) {
      pluginMode = true;
      $rightMenuNewWindow.style.display = "block";
      $rightMenuCopyLink.style.display = "block";
      domhref = href;
    } else {
      $rightMenuNewWindow.style.display = "none";
      $rightMenuCopyLink.style.display = "none";
    }

    //æ£€æŸ¥æ˜¯å¦éœ€è¦å¤åˆ¶å›¾ç‰‡
    if (imgsrc) {
      pluginMode = true;
      $rightMenuCopyImg.style.display = "block";
      $rightMenuDownloadImg.style.display = "block";
      $rightMenuNewWindowImg.style.display = "block";
      document.getElementById("rightMenu").style.width="12rem"
      domImgSrc = imgsrc;
    } else {
      $rightMenuCopyImg.style.display = "none";
      $rightMenuDownloadImg.style.display = "none";
      $rightMenuNewWindowImg.style.display = "none";
    }

    // åˆ¤æ–­æ˜¯å¦ä¸ºè¾“å…¥æ¡†
    if (event.target.tagName.toLowerCase() === "input" || event.target.tagName.toLowerCase() === "textarea") {
      pluginMode = true;
      $rightMenuPasteText.style.display = "block";
    } else {
      $rightMenuPasteText.style.display = "none";
    }
    const navMusicEl = document.querySelector("#nav-music");
    //åˆ¤æ–­æ˜¯å¦æ˜¯éŸ³ä¹
    if (navMusicEl && navMusicEl.contains(event.target)) {
      pluginMode = true;
      $rightMenuMusicToggle.style.display = "block";
      $rightMenuMusicBack.style.display = "block";
      $rightMenuMusicForward.style.display = "block";
      $rightMenuMusicPlaylist.style.display = "block";
      $rightMenuMusicCopyMusicName.style.display = "block";
    } else {
      $rightMenuMusicToggle.style.display = "none";
      $rightMenuMusicBack.style.display = "none";
      $rightMenuMusicForward.style.display = "none";
      $rightMenuMusicPlaylist.style.display = "none";
      $rightMenuMusicCopyMusicName.style.display = "none";
    }

    // å¦‚æœä¸æ˜¯æ‰©å±•æ¨¡å¼åˆ™éšè—æ‰©å±•æ¨¡å—
    if (pluginMode) {
      $rightMenuOther.style.display = "none";
      $rightMenuPlugin.style.display = "block";
    } else {
      $rightMenuPlugin.style.display = "none";
    }

    rm.reloadrmSize();

    // é¼ æ ‡é»˜è®¤æ˜¾ç¤ºåœ¨é¼ æ ‡å³ä¸‹æ–¹ï¼Œå½“é¼ æ ‡é å³æˆ–é ä¸‹æ—¶ï¼Œå°†èœå•æ˜¾ç¤ºåœ¨é¼ æ ‡å·¦æ–¹\ä¸Šæ–¹
    if (pageX + rmWidth > window.innerWidth) {
      pageX -= rmWidth + 10;
    }
    if (pageY + rmHeight > window.innerHeight) {
      pageY -= pageY + rmHeight - window.innerHeight;
    }

    rm.showRightMenu(true, pageY, pageX);
    document.getElementById("rightmenu-mask").style.display = "flex";
    return false;
  }
};

// ä¸‹è½½å›¾ç‰‡çŠ¶æ€
rm.downloadimging = false;

// å¤åˆ¶å›¾ç‰‡åˆ°å‰ªè´´æ¿
rm.writeClipImg = function (imgsrc) {
  console.log("æŒ‰ä¸‹å¤åˆ¶");
  rm.hideRightMenu();
  anzhiyu.snackbarShow("æ­£åœ¨ä¸‹è½½ä¸­ï¼Œè¯·ç¨å", false, 10000);
  if (rm.downloadimging == false) {
    rm.downloadimging = true;
    setTimeout(function () {
      copyImage(imgsrc);
      anzhiyu.snackbarShow("å¤åˆ¶æˆåŠŸï¼å›¾ç‰‡å·²æ·»åŠ ç›²æ°´å°ï¼Œè¯·éµå®ˆç‰ˆæƒåè®®");
      rm.downloadimging = false;
    }, "10000");
  }
};

function imageToBlob(imageURL) {
  const img = new Image();
  const c = document.createElement("canvas");
  const ctx = c.getContext("2d");
  img.crossOrigin = "";
  img.src = imageURL;
  return new Promise(resolve => {
    img.onload = function () {
      c.width = this.naturalWidth;
      c.height = this.naturalHeight;
      ctx.drawImage(this, 0, 0);
      c.toBlob(
        blob => {
          // here the image is a blob
          resolve(blob);
        },
        "image/png",
        0.75
      );
    };
  });
}

async function copyImage(imageURL) {
  const blob = await imageToBlob(imageURL);
  const item = new ClipboardItem({ "image/png": blob });
  navigator.clipboard.write([item]);
}

rm.switchDarkMode = function () {
  // Switch Between Light And Dark Mode
  const nowMode = document.documentElement.getAttribute("data-theme") === "dark" ? "dark" : "light";
  if (nowMode === "light") {
    activateDarkMode();
    saveToLocal.set("theme", "dark", 2);
    GLOBAL_CONFIG.Snackbar !== undefined && anzhiyu.snackbarShow(GLOBAL_CONFIG.Snackbar.day_to_night);
    document.querySelector(".menu-darkmode-text").textContent = "æµ…è‰²æ¨¡å¼";
  } else {
    activateLightMode();
    saveToLocal.set("theme", "light", 2);
    GLOBAL_CONFIG.Snackbar !== undefined && anzhiyu.snackbarShow(GLOBAL_CONFIG.Snackbar.night_to_day);
    document.querySelector(".menu-darkmode-text").textContent = "æ·±è‰²æ¨¡å¼";
  }
  // handle some cases
  typeof runMermaid === "function" && window.runMermaid();
  rm.hideRightMenu();
  anzhiyu.darkModeStatus();
};

rm.copyUrl = function (id) {
  const input = document.createElement("input"); // Create a new <input> element
  input.id = "copyVal"; // Set the id of the new element to "copyVal"
  document.body.appendChild(input); // Append the new element to the end of the <body> element
  
  const text = id;
  input.value = text;
  input.select();
  input.setSelectionRange(0, input.value.length);
  document.execCommand("copy");
  
  input.remove(); // Remove the <input> element from the DOM
};

function stopMaskScroll() {
  if (document.getElementById("rightmenu-mask")) {
    let xscroll = document.getElementById("rightmenu-mask");
    xscroll.addEventListener(
      "mousewheel",
      function (e) {
        //é˜»æ­¢æµè§ˆå™¨é»˜è®¤æ–¹æ³•
        rm.hideRightMenu();
        // e.preventDefault();
      },
      false
    );
  }
  if (document.getElementById("rightMenu")) {
    let xscroll = document.getElementById("rightMenu");
    xscroll.addEventListener(
      "mousewheel",
      function (e) {
        //é˜»æ­¢æµè§ˆå™¨é»˜è®¤æ–¹æ³•
        rm.hideRightMenu();
        // e.preventDefault();
      },
      false
    );
  }
}

rm.rightmenuCopyText = function (txt) {
  if (navigator.clipboard) {
    navigator.clipboard.writeText(txt);
  }
  rm.hideRightMenu();
};

rm.copyPageUrl = function () {
  var url = window.location.href;
  rm.copyUrl(url);
  anzhiyu.snackbarShow("å¤åˆ¶æœ¬é¡µé“¾æ¥åœ°å€æˆåŠŸ", false, 2000);
  rm.hideRightMenu();
};

rm.sharePage = function () {
  var content = window.location.href;
  rm.copyUrl(url);
  anzhiyu.snackbarShow("å¤åˆ¶æœ¬é¡µé“¾æ¥åœ°å€æˆåŠŸ", false, 2000);
  rm.hideRightMenu();
};

// å¤åˆ¶å½“å‰é€‰ä¸­æ–‡æœ¬
var selectTextNow = "";
document.onmouseup = document.ondblclick = selceText;

function selceText() {
  var txt;
  if (document.selection) {
    txt = document.selection.createRange().text;
  } else {
    txt = window.getSelection().toString();
  }
  selectTextNow = txt !== "" ? txt : "";
}

// è¯»å–å‰ªåˆ‡æ¿
rm.readClipboard = function () {
  if (navigator.clipboard) {
    navigator.clipboard.readText().then(clipText => rm.insertAtCaret(globalEvent.target, clipText));
  }
};

// ç²˜è´´æ–‡æœ¬åˆ°ç„¦ç‚¹
rm.insertAtCaret = function (elemt, value) {
  const startPos = elemt.selectionStart,
    endPos = elemt.selectionEnd;
  if (document.selection) {
    elemt.focus();
    var sel = document.selection.createRange();
    sel.text = value;
    elemt.focus();
  } else {
    if (startPos || startPos == "0") {
      var scrollTop = elemt.scrollTop;
      elemt.value = elemt.value.substring(0, startPos) + value + elemt.value.substring(endPos, elemt.value.length);
      elemt.focus();
      elemt.selectionStart = startPos + value.length;
      elemt.selectionEnd = startPos + value.length;
      elemt.scrollTop = scrollTop;
    } else {
      elemt.value += value;
      elemt.focus();
    }
  }
};

//ç²˜è´´æ–‡æœ¬
rm.pasteText = function () {
  const result = rm.readClipboard() || "";
  rm.hideRightMenu();
};

//å¼•ç”¨åˆ°è¯„è®º
rm.rightMenuCommentText = function (txt) {
  rm.hideRightMenu();
  const postCommentDom = document.getElementById("post-comment");
  var domTop = postCommentDom.offsetTop;
  window.scrollTo(0, domTop - 80);
  if (txt == "undefined" || txt == "null") txt = "å¥½æ£’ï¼";
  function setText() {
    setTimeout(() => {
      var input = document.getElementsByClassName("el-textarea__inner")[0];
      if (!input) setText();
      let evt = document.createEvent("HTMLEvents");
      evt.initEvent("input", true, true);
      let inputValue = replaceAll(txt, "\n", "\n> ");
      input.value = "> " + inputValue + "\n\n";
      input.dispatchEvent(evt);
      input.focus();
      input.setSelectionRange(-1, -1);
      if (document.getElementById("comment-tips")) {
        document.getElementById("comment-tips").classList.add("show");
      }
    }, 100);
  }
  setText();
};

//æ›¿æ¢æ‰€æœ‰å†…å®¹
function replaceAll(string, search, replace) {
  return string.split(search).join(replace);
}

// ç™¾åº¦æœç´¢
rm.searchBaidu = function () {
  anzhiyu.snackbarShow("å³å°†è·³è½¬åˆ°ç™¾åº¦æœç´¢", false, 2000);
  setTimeout(function () {
    window.open("https://www.baidu.com/s?wd=" + selectTextNow);
  }, "2000");
  rm.hideRightMenu();
};

//åˆ†äº«é“¾æ¥
rm.copyLink = function () {
  rm.rightmenuCopyText(domhref);
  anzhiyu.snackbarShow("å·²å¤åˆ¶é“¾æ¥åœ°å€");
};

function addRightMenuClickEvent() {
  // æ·»åŠ ç‚¹å‡»äº‹ä»¶
  document.getElementById("menu-backward").addEventListener("click", function () {
  window.history.back();
    rm.hideRightMenu();
  });

  document.getElementById("menu-forward").addEventListener("click", function () {
    window.history.forward();
    rm.hideRightMenu();
  });

  document.getElementById("menu-refresh").addEventListener("click", function () {
    window.location.reload();
  });

  document.getElementById("menu-top").addEventListener("click", function () {
    anzhiyu.scrollToDest(0, 500);
    rm.hideRightMenu();
  });

  const menuLinks = document.querySelectorAll(".menu-link");
  menuLinks.forEach(function (link) {
    link.addEventListener("click", rm.hideRightMenu);
  });

  document.getElementById("menu-darkmode").addEventListener("click", rm.switchDarkMode);

  document.getElementById("menu-home") && document.getElementById("menu-home").addEventListener("click", function () {
    window.location.href = window.location.origin;
  });

  document.getElementById("menu-randomPost").addEventListener("click", function () {
    toRandomPost();
  });

  document.getElementById("menu-commentBarrage").addEventListener("click", anzhiyu.switchCommentBarrage);

  document.getElementById("rightmenu-mask").addEventListener("click", rm.hideRightMenu);

  document.getElementById("rightmenu-mask").addEventListener("contextmenu", function (event) {
    rm.hideRightMenu();
    event.preventDefault(); // Prevent the default context menu from appearing
  });

  document.getElementById("menu-copy").addEventListener("click", rm.copyPageUrl);

  document.getElementById("menu-pastetext").addEventListener("click", rm.pasteText);

  document.getElementById("menu-copytext").addEventListener("click", function () {
    rm.rightmenuCopyText(selectTextNow);
    anzhiyu.snackbarShow("å¤åˆ¶æˆåŠŸï¼Œå¤åˆ¶å’Œè½¬è½½è¯·æ ‡æ³¨æœ¬æ–‡åœ°å€");
  });

  document.getElementById("menu-commenttext").addEventListener("click", function () {
    rm.rightMenuCommentText(selectTextNow);
  });

  document.getElementById("menu-newwindow").addEventListener("click", function () {
    window.open(domhref);
    rm.hideRightMenu();
  });

  document.getElementById("menu-copylink").addEventListener("click", rm.copyLink);

  document.getElementById("menu-downloadimg").addEventListener("click", function () {
    anzhiyu.downloadImage(domImgSrc, "anzhiyu");
  });

  document.getElementById("menu-newwindowimg").addEventListener("click", function () {
    window.open(domImgSrc);
    rm.hideRightMenu();
  });

  document.getElementById("menu-copyimg").addEventListener("click", function () {
    rm.writeClipImg(domImgSrc);
  });

  document.getElementById("menu-searchBaidu").addEventListener("click", rm.searchBaidu);

  //éŸ³ä¹
  document.getElementById("menu-music-toggle").addEventListener("click", anzhiyu.musicToggle);

  document.getElementById("menu-music-back").addEventListener("click", anzhiyu.musicSkipBack);

  document.getElementById("menu-music-forward").addEventListener("click", anzhiyu.musicSkipForward);

  document.getElementById("menu-music-copyMusicName").addEventListener("click", function () {
    rm.rightmenuCopyText(anzhiyu.musicGetName());
    anzhiyu.snackbarShow("å¤åˆ¶æ­Œæ›²åç§°æˆåŠŸ", false, 3000);
  });

}

addRightMenuClickEvent();</script><script data-pjax>var themeColorMeta = document.querySelector('meta[name="theme-color"]');
var pageHeaderEl = document.getElementById("page-header");
var navMusicEl = document.getElementById("nav-music");
var consoleEl = document.getElementById("console");
// å·²éšæœºçš„æ­Œæ›²
var selectRandomSong = [];
// éŸ³ä¹é»˜è®¤å£°éŸ³å¤§å°
var musicVolume = 0.8;
// æ˜¯å¦åˆ‡æ¢äº†å‘¨æ°ä¼¦éŸ³ä¹åˆ—è¡¨
var changeMusicListFlag = false;
// å½“å‰é»˜è®¤æ’­æ”¾åˆ—è¡¨
var defaultPlayMusicList = [];

document.getElementById("page-name").innerText = document.title.split(" | å®‰çŸ¥é±¼")[0];
anzhiyu.initIndexEssay();
anzhiyu.changeTimeInEssay();
anzhiyu.removeBodyPaceClass();
anzhiyu.qrcodeCreate();
anzhiyu.changeTimeInAlbumDetail();
anzhiyu.reflashEssayWaterFall();
anzhiyu.sayhi();
anzhiyu.stopImgRightDrag();
anzhiyu.addNavBackgroundInit();
anzhiyu.setValueToBodyType();

anzhiyu.getCustomPlayList();
anzhiyu.addEventListenerConsoleMusicList(false);</script><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.6/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://npm.elemecdn.com/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://npm.elemecdn.com/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)
  window.anzhiyuScrollFnToDo && window.removeEventListener('scroll', anzhiyuScrollFnToDo)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script></div></body></html>